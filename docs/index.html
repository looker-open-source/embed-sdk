<!DOCTYPE html><html class="default"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@looker/embed-sdk</title><meta name="description" content="Documentation for @looker/embed-sdk"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.body.classList.add(localStorage.getItem("tsd-theme") || "os")</script><header><div class="tsd-page-toolbar"><div class="container"><div class="table-wrap"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption">Search</label><input type="text" id="tsd-search-field"/></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">@looker/embed-sdk</a></div><div class="table-cell" id="tsd-widgets"><div id="tsd-filter"><a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a><div class="tsd-filter-group"><div class="tsd-select" id="tsd-filter-visibility"><span class="tsd-select-label">All</span><ul class="tsd-select-list"><li data-value="public">Public</li><li data-value="protected">Public/Protected</li><li data-value="private" class="selected">All</li></ul></div> <input type="checkbox" id="tsd-filter-inherited" checked/><label class="tsd-widget" for="tsd-filter-inherited">Inherited</label><input type="checkbox" id="tsd-filter-externals" checked/><label class="tsd-widget" for="tsd-filter-externals">Externals</label></div></div><a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a></div></div></div></div><div class="tsd-page-title"><div class="container"><h1>@looker/embed-sdk </h1></div></div></header><div class="container container-main"><div class="row"><div class="col-8 col-content"><div class="tsd-panel tsd-typography">
<a href="#looker-javascript-embed-sdk" id="looker-javascript-embed-sdk" style="color: inherit; text-decoration: none;">
  <h1>Looker JavaScript Embed SDK</h1>
</a>

<a href="#embed-sdk-version-200" id="embed-sdk-version-200" style="color: inherit; text-decoration: none;">
  <h2>Embed SDK version 2.0.0</h2>
</a>
<p>The following document has been updated to reflect the creation of Embed SDK 2.0.0. Technically the 2.0.0 API is backwards compatible with Embed SDK 1.8.x but the underlying implementation has changed for some functionality. SDK 1.8.x exported a number of classes. SDK 2.0.0 replaces these classes with interfaces that are marked as deprecated (alternative interfaces are identified). It is preferred that applications use the &#39;I&#39; prefixed interfaces (which are identical to the non prefixed interfaces). Applications upgrading to SDK 2.0.0 should behave the same. In order to take advantage of the API improvements some refactoring will be required.</p>
<p>The major changes included in Embed SDK 2.0.0 are:</p>
<ol>
<li>Navigating between Dashboards, Explores and Looks no longer requires the recreation of an IFRAME. Instead the <code>loadDashboard</code>, <code>loadLook</code>, <code>loadExplore</code> and <code>loadUrl</code> methods can be used to navigate within the Looker IFRAME.</li>
<li><code>connect</code> now returns a unified connection rather than a connection related to a Dashboard, Look or Explore. The unified connection allows embedding applications to be aware of the user navigating inside of the IFRAME.</li>
<li>Support for additional Looker embedded content has been added:<ul>
<li>Reports.</li>
<li>Query Visualizations.</li>
</ul>
</li>
</ol>

<a href="#introduction" id="introduction" style="color: inherit; text-decoration: none;">
  <h2>Introduction</h2>
</a>
<p>The Looker JavaScript Embed SDK is designed to facilitate using Looker embedded content in a web application. The goal is to make communication between a host website and one or more embedded Dashboards, Looks, Explores, Reports and Extensions easier and more reliable.</p>
<p>The Looker JavaScript Embed SDK typically uses embed SSO to sign an embed url in order to authenticate the user of the embedded content. This mechanism relies on Looker cookies being available to the embedded IFRAME in order for the application to work. It is recommended that customers use vanity domains where the embedded server and the Looker server run on the same domain but different subdomains. By doing this third party cookie blocking is mitigated (as the cookies are no longer third party). Alternatively Looker provides a mechanism that allows embedded Looker IFRAMEs to work without the need for cookies. Details can be found <a href="#cookieless">here</a>.</p>
<p>A typical setup might look like this. In this case, a dashboard with an id of <code>11</code> is created inside a DOM element with the id <code>embed_container</code>. The <code>dashboard:run:start</code> and <code>dashboard:run:complete</code> events are used to update the state of the embedding window&#39;s UI, and a button with an id of <code>run</code> is scripted to send a <code>dashboard:run</code> message to the dashboard.</p>
<pre><code class="language-javascript"><span class="hl-0">getEmbedSDK</span><span class="hl-1">().</span><span class="hl-0">init</span><span class="hl-1">(</span><span class="hl-2">&#39;looker.example.com&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;/auth&#39;</span><span class="hl-1">)</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-0">setupConnection</span><span class="hl-1"> = (</span><span class="hl-4">connection</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">document</span><span class="hl-1">.</span><span class="hl-0">querySelector</span><span class="hl-1">(</span><span class="hl-2">&#39;#run&#39;</span><span class="hl-1">).</span><span class="hl-0">addEventListener</span><span class="hl-1">(</span><span class="hl-2">&#39;click&#39;</span><span class="hl-1">, () </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">connection</span><span class="hl-1">.</span><span class="hl-0">asDashboardConnection</span><span class="hl-1">().</span><span class="hl-0">run</span><span class="hl-1">()</span><br/><span class="hl-1">  })</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">try</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">connection</span><span class="hl-1"> = </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-0">getEmbedSDK</span><span class="hl-1">()</span><br/><span class="hl-1">    .</span><span class="hl-0">createDashboardWithId</span><span class="hl-1">(</span><span class="hl-2">&#39;11&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">    .</span><span class="hl-0">appendTo</span><span class="hl-1">(</span><span class="hl-2">&#39;#embed_container&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">    .</span><span class="hl-0">on</span><span class="hl-1">(</span><span class="hl-2">&#39;dashboard:run:start&#39;</span><span class="hl-1">, () </span><span class="hl-3">=&gt;</span><span class="hl-1"> </span><span class="hl-0">updateStatus</span><span class="hl-1">(</span><span class="hl-2">&#39;Running&#39;</span><span class="hl-1">))</span><br/><span class="hl-1">    .</span><span class="hl-0">on</span><span class="hl-1">(</span><span class="hl-2">&#39;dashboard:run:complete&#39;</span><span class="hl-1">, () </span><span class="hl-3">=&gt;</span><span class="hl-1"> </span><span class="hl-0">updateStatus</span><span class="hl-1">(</span><span class="hl-2">&#39;Done&#39;</span><span class="hl-1">))</span><br/><span class="hl-1">    .</span><span class="hl-0">build</span><span class="hl-1">()</span><br/><span class="hl-1">    .</span><span class="hl-0">connect</span><span class="hl-1">()</span><br/><span class="hl-1">  </span><span class="hl-0">setupConnection</span><span class="hl-1">(</span><span class="hl-4">connection</span><span class="hl-1">)</span><br/><span class="hl-1">} </span><span class="hl-5">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">&#39;An unexpected error occurred&#39;</span><span class="hl-1">, </span><span class="hl-4">error</span><span class="hl-1">)</span><br/><span class="hl-1">}</span>
</code></pre>
<p>A more complete example can be found <a href="https://github.com/looker-open-source/embed-sdk/blob/master/demo/demo_single_frame.ts">here</a> and <a href="https://github.com/looker-open-source/embed-sdk/blob/master/demo/demo_multi_frame.ts">here</a>.</p>

<a href="#details" id="details" style="color: inherit; text-decoration: none;">
  <h2>Details</h2>
</a>
<p>The Looker Embed SDK uses the fluent interface pattern. The construction of the embedded content is broken into two phases, building and connecting. The hosting application may interact with the embedded content once the connection is established.</p>

<a href="#building" id="building" style="color: inherit; text-decoration: none;">
  <h3>Building</h3>
</a>
<p>Initialize the SDK with the address of the Looker server and the endpoint of the embedding application server that will create a signed Looker embedded login URL (for private embedding, omit the signing endpoint).</p>
<pre><code class="language-javascript"><span class="hl-0">getEmbedSDK</span><span class="hl-1">().</span><span class="hl-0">init</span><span class="hl-1">(</span><span class="hl-2">&#39;looker.example.com&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;/auth&#39;</span><span class="hl-1">)</span>
</code></pre>
<p>In this example, <code>/auth</code> is a backend service that must be implemented as described in the <a href="#the-auth-endpoint">Signed URL Auth Endpoint</a> section.</p>
<p>After the SDK is initialized, create the builder using an <code>id</code> or <code>URL</code>. For example, to create a Dashboard embed builder do one of the following:</p>
<pre><code class="language-javascript"><span class="hl-0">getEmbedSDK</span><span class="hl-1">().</span><span class="hl-0">createDashboardWithId</span><span class="hl-1">(</span><span class="hl-2">&#39;42&#39;</span><span class="hl-1">)</span><br/><span class="hl-6">// OR</span><br/><span class="hl-0">getEmbedSDK</span><span class="hl-1">().</span><span class="hl-0">createDashboardWithUrl</span><span class="hl-1">(</span><span class="hl-2">&#39;/embed/dashboards/42?state=california&#39;</span><span class="hl-1">)</span>
</code></pre>
<p>The <code>create[ContentType]WithUrl</code> functions can used with both signed and cookieless embed starting with Embed SDK 2.0.0. Prior to Embed SDK 2.0.0, Cookieless Embed only supported <code>create[CotentType]WithId</code>.</p>
<p>Additional attributes can be added to the builder to complete the setup:</p>
<pre><code class="language-javascript"><span class="hl-1">  .</span><span class="hl-0">appendTo</span><span class="hl-1">(</span><span class="hl-2">&#39;#dashboard&#39;</span><span class="hl-1">)</span>
</code></pre>
<p>Event handlers can be added:</p>
<pre><code class="language-javascript"><span class="hl-1">  .</span><span class="hl-0">on</span><span class="hl-1">(</span><span class="hl-2">&#39;dashboard:run:start&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      () </span><span class="hl-3">=&gt;</span><span class="hl-1"> </span><span class="hl-0">updateStatus</span><span class="hl-1">(</span><span class="hl-2">&#39;Running&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  )</span><br/><span class="hl-1">  .</span><span class="hl-0">on</span><span class="hl-1">(</span><span class="hl-2">&#39;dashboard:run:complete&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      () </span><span class="hl-3">=&gt;</span><span class="hl-1"> </span><span class="hl-0">updateStatus</span><span class="hl-1">(</span><span class="hl-2">&#39;Done&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  )</span>
</code></pre>
<p>Create an embedded client by calling the build method:</p>
<pre><code class="language-javascript"><span class="hl-1">  .</span><span class="hl-0">build</span><span class="hl-1">()</span>
</code></pre>

<a href="#connecting" id="connecting" style="color: inherit; text-decoration: none;">
  <h3>Connecting</h3>
</a>
<p>Once the client is built, call <code>connect</code> to create the IFRAME. The connect process creates the <code>src</code> attribute used for the actual IFRAME. How the <code>src</code> value is generated is based upon how the embed SDK is initialized.</p>
<ol>
<li>Signed - the endpoint specified by the 2nd argument of the <code>init</code> call is called. The endpoint is expected to return a signed embed login URL.</li>
<li>Cookieless - the endpoint or the function specified by the 2nd argument of the <code>initCookieless</code> call is called. The endpoint or function is expected to return cookieless tokens, in particular the authentication and navigation tokens. The tokens are appended to the embed login URL.</li>
<li>Private - the embed connection is private if the 2nd argument of the <code>init</code> call is not provided. In this case the URL is derived from the builder and decorated with the parameters required for Looker embed. For private embed, it is expected that the user is already logged into Looker OR that embedding URL include the <code>allow_login_screen=true</code> parameter.</li>
</ol>
<p><code>connect</code> returns a Promise that resolves to the connection interface for the embedded IFRAME.</p>
<pre><code class="language-javascript"><span class="hl-1">  .</span><span class="hl-0">connect</span><span class="hl-1">()</span><br/><span class="hl-1">  .</span><span class="hl-0">then</span><span class="hl-1">((</span><span class="hl-4">connection</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">// Save the connection</span><br/><span class="hl-1">  })</span><br/><span class="hl-1">  .</span><span class="hl-0">catch</span><span class="hl-1">(</span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-4">error</span><span class="hl-1">)</span>
</code></pre>

<a href="#interacting" id="interacting" style="color: inherit; text-decoration: none;">
  <h3>Interacting</h3>
</a>
<p>Embed SDK 2.0.0 returns a unified connection that supports interacting with all Looker content types. The Embedding application can determine what kind of content is currently being displayed and interact accordingly.</p>
<pre><code class="language-javascript"><span class="hl-5">if</span><span class="hl-1"> (</span><span class="hl-4">connection</span><span class="hl-1">.</span><span class="hl-0">getPageType</span><span class="hl-1">() === </span><span class="hl-2">&#39;dashboards&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-4">connection</span><span class="hl-1">.</span><span class="hl-0">asDashboardConnection</span><span class="hl-1">().</span><span class="hl-0">run</span><span class="hl-1">()</span><br/><span class="hl-1">} </span><span class="hl-5">else</span><span class="hl-1"> (</span><span class="hl-4">connection</span><span class="hl-1">.</span><span class="hl-0">getPageType</span><span class="hl-1">() === </span><span class="hl-2">&#39;looks&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-4">connection</span><span class="hl-1">.</span><span class="hl-0">asLookConnection</span><span class="hl-1">().</span><span class="hl-0">run</span><span class="hl-1">()</span><br/><span class="hl-1">} </span><span class="hl-5">else</span><span class="hl-1"> (</span><span class="hl-4">connection</span><span class="hl-1">.</span><span class="hl-0">getPageType</span><span class="hl-1">() === </span><span class="hl-2">&#39;explore&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-4">connection</span><span class="hl-1">.</span><span class="hl-0">asExploreConnection</span><span class="hl-1">().</span><span class="hl-0">run</span><span class="hl-1">()</span><br/><span class="hl-1">}</span>
</code></pre>
<p>It is no longer necessary to recreate the IFRAME when there is a need to load different content. Instead the connection <code>loadDashboard</code>, <code>loadLook</code>, <code>loadExplore</code> or <code>loadUrl</code> methods can be used. The <code>loadDashboard</code>, <code>loadLook</code>, <code>loadExplore</code> methods accept an <code>id</code>. The <code>loadUrl</code> method accepts an Embed <code>URL</code> and so can be used to specify additional parameters, filters for example.</p>
<pre><code class="language-javascript"><span class="hl-4">connection</span><span class="hl-1">.</span><span class="hl-0">loadDashboard</span><span class="hl-1">(</span><span class="hl-2">&#39;42&#39;</span><span class="hl-1">)</span><br/><span class="hl-6">// OR</span><br/><span class="hl-4">connection</span><span class="hl-1">.</span><span class="hl-0">loadUrl</span><span class="hl-1">(</span><span class="hl-2">&#39;/embed/dashboards/42?state=california&#39;</span><span class="hl-1">)</span>
</code></pre>
<p>If it is necessary to create a new IFRAME, the Embed SDK will not call the signing or acquire session endpoints again. Instead it will construct IFRAME src directly from the builder. Should it be necessary to create a new Embed session, the Embed SDK will need to be reinitialized as follows:</p>
<pre><code class="language-javascript"><span class="hl-0">getEmbedSDK</span><span class="hl-1">(</span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">LookerEmbedExSDK</span><span class="hl-1">()).</span><span class="hl-0">init</span><span class="hl-1">(</span><span class="hl-2">&#39;looker.example.com&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;/auth&#39;</span><span class="hl-1">)</span>
</code></pre>

<a href="#building-urls-for-the-sdk" id="building-urls-for-the-sdk" style="color: inherit; text-decoration: none;">
  <h2>Building URLs for the SDK</h2>
</a>
<p><em>The Embed SDK 2.0.0 now supports URL building for cookieless embed.</em></p>
<p>The main documentation for Looker SSO embed URLs is <a href="https://docs.looker.com/r/sdk/sso-embed">here</a>.</p>
<p>The Embed SDK will sanitize the URL if necessary:</p>
<ol>
<li>It will strip hostname and protocol if present.</li>
<li>It will prefix the URL with <code>/embed</code> if missing.</li>
<li>It will add the <code>sdk</code> parameter if missing.</li>
<li>It will add the <code>embed_domain</code> parameter if missing.</li>
<li>It will throw an error if the URL is invalid.</li>
</ol>
<p><code>/embed/looks/4?embed_domain=https://mywebsite.com</code> becomes <code>/embed/looks/4?embed_domain=https://mywebsite.com&amp;sdk=3</code>.</p>
<p>&lt;a name=&quot;the-auth-endpoint&quot; name&quot;the-auth-endpoint&quot;&gt;</a></p>

<a href="#signed-url-auth-endpoint" id="signed-url-auth-endpoint" style="color: inherit; text-decoration: none;">
  <h2>Signed URL Auth Endpoint</h2>
</a>
<p>This section does not apply to cookieless embed. See the <a href="#cookieless">cookieless embed</a> section for details.</p>
<p>In order to use the Embed SDK on the frontend you must supply a backend service that handles signing of the Embed URL. This service is called by the Embed SDK to generate a signed URL that is unique to the requesting user. The backend process can either generate the signed embed URL itself using an embed secret or can generate the URL by calling the <a href="https://cloud.google.com/looker/docs/reference/looker-api/latest/methods/Auth/create_sso_embed_url">Looker Create Signed Embed URL API</a>. Manual URL generation and signing avoids calling the Looker API resulting in decreased latency. Calling the Looker API requires less code and is easier to maintain.</p>
<p>A javascript example of a helper method that generates a signed URL, <code>createSignedUrl()</code>, can be found in <a href="https://github.com/looker-open-source/embed-sdk/blob/master/server/utils/auth_utils.ts">server/utils/auth_utils.ts</a>. Its usage is as follows:</p>
<pre><code class="language-javascript"><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-4">createSignedUrl</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;./utils/auth_utils&#39;</span><br/><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-0">get</span><span class="hl-1">(</span><span class="hl-2">&#39;/looker_auth&#39;</span><span class="hl-1">, </span><span class="hl-3">function</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-6">// It is assumed that the request is authorized</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-7">src</span><span class="hl-1"> = </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">src</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-7">host</span><span class="hl-1"> = </span><span class="hl-2">&#39;looker.example.com&#39;</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-7">secret</span><span class="hl-1"> = ... </span><span class="hl-6">// Embed secret from Looker Server Embed Admin page</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-7">user</span><span class="hl-1"> = ... </span><span class="hl-6">// Embedded user definition</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-7">url</span><span class="hl-1"> = </span><span class="hl-0">createSignedUrl</span><span class="hl-1">(</span><span class="hl-4">src</span><span class="hl-1">, </span><span class="hl-4">user</span><span class="hl-1">, </span><span class="hl-4">host</span><span class="hl-1">, </span><span class="hl-4">secret</span><span class="hl-1">)</span><br/><span class="hl-1">  </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-0">json</span><span class="hl-1">({ </span><span class="hl-4">url</span><span class="hl-1"> })</span><br/><span class="hl-1">})</span>
</code></pre>
<p>A python example of the same method can be found <a href="https://github.com/looker-open-source/embed-sdk/blob/master/server_utils/auth_utils.py">here</a>.</p>

<a href="#signed-url-advanced-auth-configuration" id="signed-url-advanced-auth-configuration" style="color: inherit; text-decoration: none;">
  <h3>Signed URL Advanced Auth Configuration</h3>
</a>
<p>This section does not apply to cookieless embed. See the <a href="#cookieless">cookieless embed</a> section for details.</p>
<p>The Auth endpoint can be configured further, allowing custom Request Headers, as well as CORS support by passing an options object to the <code>init</code> method</p>
<pre><code class="language-javascript"><span class="hl-0">getEmbedSDK</span><span class="hl-1">().</span><span class="hl-0">init</span><span class="hl-1">(</span><span class="hl-2">&#39;looker.example.com&#39;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-4">url:</span><span class="hl-1"> </span><span class="hl-2">&#39;https://api.acme.com/looker/auth&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">headers:</span><span class="hl-1"> [{ </span><span class="hl-4">name:</span><span class="hl-1"> </span><span class="hl-2">&#39;Foo Header&#39;</span><span class="hl-1">, </span><span class="hl-4">value:</span><span class="hl-1"> </span><span class="hl-2">&#39;Foo&#39;</span><span class="hl-1"> }],</span><br/><span class="hl-1">  </span><span class="hl-4">params:</span><span class="hl-1"> [{ </span><span class="hl-4">name:</span><span class="hl-1"> </span><span class="hl-2">&#39;foo&#39;</span><span class="hl-1">, </span><span class="hl-4">value:</span><span class="hl-1"> </span><span class="hl-2">&#39;bar&#39;</span><span class="hl-1"> }],</span><br/><span class="hl-1">  </span><span class="hl-4">withCredentials:</span><span class="hl-1"> </span><span class="hl-3">true</span><span class="hl-1">, </span><span class="hl-6">// Needed for CORS requests to Auth endpoint include Http Only cookie headers</span><br/><span class="hl-1">})</span>
</code></pre>
<p><a name='cookieless' id='cookieless'></a></p>

<a href="#cookieless-embed" id="cookieless-embed" style="color: inherit; text-decoration: none;">
  <h2>Cookieless Embed</h2>
</a>
<p><em>Cookieless embed in Embed SDK 2.0.0 now supports the use of <code>withUrl</code>.</em></p>
<p>Looker Cookieless embed allows the Looker application to be embedded by an html page that is served from a different domain than the Looker server. With signed URL embed, to avoid third party cookie blocking, the Looker server must be served from a sub domain of the hosting application OR the user must enable third party cookies in the browser. Enabling cookieless embedding is documented in more detail <a href="https://cloud.google.com/looker/docs/r/sdk/cookieless-embed">here</a>. Cookieless embed is available with Looker version 22.20 and above.</p>
<p>Cookieless embed works by using short lived tokens that are kept in the browser and are used to reference the actual session in the Looker server. The Looker UI keeps track of the tokens, and before they expire, requests that the hosting application generate new ones. To this end, the host application is required to implement supporting functionality in the client and in the server.</p>
<p>This functionality will:</p>
<ul>
<li>Acquire a new session either by creating or attaching to an existing session associated with the browser (this allows the user to create new IFRAMEs and use the same session).</li>
<li>Generate new tokens.</li>
</ul>

<a href="#acquire-session-backend-process" id="acquire-session-backend-process" style="color: inherit; text-decoration: none;">
  <h3>Acquire session backend process</h3>
</a>
<p>This process is called every time a Looker Embed IFRAME is created. The acquire session backend process requires that the Looker API endpoint <code>acquire_embed_cookieless_session</code> be called to create an embed session or attach to an existing embed session. The endpoint accepts an embed user definition and creates or updates it. This is similar behavior to the signed URL embed login as they both can create and update embed user definitions.
One major difference in the payloads is that <code>force_logout_login</code> is ignored by <code>acquire_embed_cookieless_session</code>. Cookieless embed logins ALWAYS forces logout login (as the Looker cookies are blocked this should be a noop).</p>
<p>Cookieless embed sessions are associated with the user&#39;s browser user agent. It is important that that user agent for the browser be set with the request.</p>
<p>If successful, the <code>acquire_embed_cookieless_session</code> returns a number of tokens:</p>
<ul>
<li><code>session_reference_token</code> - this token is used to generate new tokens and created new IFRAMEs. It is important to secure and keep track of this token. It should not be returned to the browser. This token lives for the duration of the session. A new cookieless embed session will need to be created when the <code>session_reference_token</code> expires.</li>
<li><code>authentication_token</code> - this is one time token that has a lifespan of 30 seconds. It is used with the <code>/login/embed/{target}</code> endpoint.</li>
<li><code>navigation_token</code> - this token is used to navigate to different Looker pages in the Looker application. This token lives for 10 minutes.</li>
<li><code>api_token</code> - this token is used for api calls. This token lives for 10 minutes.</li>
</ul>
<p>A time to live for each token is also returned. It is important that the response of the <code>acquire_embed_cookieless_session</code> be returned to the browser with the exception of the <code>session_reference_token</code>. The hosting application MUST keep track of the <code>session_reference_token</code> for each user.</p>
<p>The example shown below is simplistic and uses an in memory cache to keep track of the <code>session_reference_token</code>. In memory caches will not work in clustered environments so use a distributed cache such as <code>redis</code> in production. An alternative is to save the <code>session_reference_token</code> in an encrypted session cookie. The use of session cookies is demonstrated <a href="/server_utils/routes.ts">here</a>.</p>
<pre><code class="language-javascript"><span class="hl-6">// Simple endpoint to acquire an embed session. In this case the user data</span><br/><span class="hl-6">// comes from a configuration file. In a real life application the user data</span><br/><span class="hl-6">// would be derived from the embedding hosts session.</span><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-0">get</span><span class="hl-1">(</span><span class="hl-2">&#39;/acquire-embed-session&#39;</span><span class="hl-1">, </span><span class="hl-3">async</span><span class="hl-1"> </span><span class="hl-3">function</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-5">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-7">tokens</span><span class="hl-1"> = </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-0">acquireEmbedSession</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">headers</span><span class="hl-1">[</span><span class="hl-2">&#39;user-agent&#39;</span><span class="hl-1">], </span><span class="hl-4">user</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-0">json</span><span class="hl-1">(</span><span class="hl-4">tokens</span><span class="hl-1">)</span><br/><span class="hl-1">  } </span><span class="hl-5">catch</span><span class="hl-1"> (</span><span class="hl-4">err</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-0">status</span><span class="hl-1">(</span><span class="hl-8">400</span><span class="hl-1">).</span><span class="hl-0">send</span><span class="hl-1">({ </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-4">err</span><span class="hl-1">.</span><span class="hl-4">message</span><span class="hl-1"> })</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">})</span><br/><br/><span class="hl-6">// The Looker session. In a real application this should not be a global variable,</span><br/><span class="hl-3">let</span><span class="hl-1"> </span><span class="hl-4">lookerSession</span><br/><br/><span class="hl-6">// A very simple cache for storing embed sessions. In a real life application the</span><br/><span class="hl-6">// embed session should be associated with the embedding application user&#39;s session.</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-7">embedSessions</span><span class="hl-1"> = {}</span><br/><br/><span class="hl-6">// Simple function to acquire a looker session and then acquire an embed</span><br/><span class="hl-6">// session.</span><br/><span class="hl-3">async</span><span class="hl-1"> </span><span class="hl-3">function</span><span class="hl-1"> </span><span class="hl-0">acquireEmbedSession</span><span class="hl-1">(</span><span class="hl-4">userAgent</span><span class="hl-1">, </span><span class="hl-4">user</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-0">acquireLookerSession</span><span class="hl-1">()</span><br/><span class="hl-1">  </span><span class="hl-5">return</span><span class="hl-1"> </span><span class="hl-0">acquireEmbedSessionInternal</span><span class="hl-1">(</span><span class="hl-4">userAgent</span><span class="hl-1">, </span><span class="hl-4">user</span><span class="hl-1">)</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-6">// Simple function to acquire a Looker API session.</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-0">acquireLookerSession</span><span class="hl-1"> = </span><span class="hl-3">async</span><span class="hl-1"> () </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">if</span><span class="hl-1"> (!</span><span class="hl-4">lookerSession</span><span class="hl-1"> || !</span><span class="hl-4">lookerSession</span><span class="hl-1">.</span><span class="hl-4">activeToken</span><span class="hl-1">.</span><span class="hl-0">isActive</span><span class="hl-1">()) {</span><br/><span class="hl-1">    </span><span class="hl-3">const</span><span class="hl-1"> { </span><span class="hl-7">api_url</span><span class="hl-1">, </span><span class="hl-7">client_id</span><span class="hl-1">, </span><span class="hl-7">client_secret</span><span class="hl-1">, </span><span class="hl-7">verify_ssl</span><span class="hl-1"> } = </span><span class="hl-4">config</span><br/><span class="hl-1">    </span><span class="hl-5">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-7">lookerSettings</span><span class="hl-1"> = </span><span class="hl-0">DefaultSettings</span><span class="hl-1">()</span><br/><span class="hl-1">      </span><span class="hl-4">lookerSettings</span><span class="hl-1">.</span><span class="hl-0">readConfig</span><span class="hl-1"> = () </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-5">return</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-4">client_id</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">client_secret</span><span class="hl-1">,</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-4">lookerSettings</span><span class="hl-1">.</span><span class="hl-4">base_url</span><span class="hl-1"> = </span><span class="hl-4">api_url</span><br/><span class="hl-1">      </span><span class="hl-4">lookerSettings</span><span class="hl-1">.</span><span class="hl-4">verify_ssl</span><span class="hl-1"> = </span><span class="hl-4">verify_ssl</span><br/><span class="hl-1">      </span><span class="hl-4">lookerSession</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">NodeSession</span><span class="hl-1">(</span><span class="hl-4">lookerSettings</span><span class="hl-1">)</span><br/><span class="hl-1">      </span><span class="hl-4">lookerSession</span><span class="hl-1">.</span><span class="hl-0">login</span><span class="hl-1">()</span><br/><span class="hl-1">    } </span><span class="hl-5">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">&#39;login failed&#39;</span><span class="hl-1">, { </span><span class="hl-4">error</span><span class="hl-1"> })</span><br/><span class="hl-1">      </span><span class="hl-5">throw</span><span class="hl-1"> </span><span class="hl-4">error</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-6">// Simple function to acquire the embed session.</span><br/><span class="hl-6">// Note as an additional layer of security the user agent of users</span><br/><span class="hl-6">// browser is associated with the embed session. It is important</span><br/><span class="hl-6">// that this is available when the embed session is created.</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-0">acquireEmbedSessionInternal</span><span class="hl-1"> = </span><span class="hl-3">async</span><span class="hl-1"> (</span><span class="hl-4">userAgent</span><span class="hl-1">, </span><span class="hl-4">user</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-7">cacheKey</span><span class="hl-1"> = </span><span class="hl-2">`</span><span class="hl-3">${</span><span class="hl-4">user</span><span class="hl-9">.</span><span class="hl-4">external_user_id</span><span class="hl-3">}</span><span class="hl-2">/</span><span class="hl-3">${</span><span class="hl-4">userAgent</span><span class="hl-3">}</span><span class="hl-2">`</span><br/><span class="hl-1">    </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-7">embedSession</span><span class="hl-1"> = </span><span class="hl-4">embedSessions</span><span class="hl-1">[</span><span class="hl-4">cacheKey</span><span class="hl-1">]</span><br/><span class="hl-1">    </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-7">request</span><span class="hl-1"> = {</span><br/><span class="hl-1">      ...</span><span class="hl-4">user</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">session_reference_token:</span><span class="hl-1"> </span><span class="hl-4">embedSession</span><span class="hl-1">?.</span><span class="hl-4">session_reference_token</span><span class="hl-1">,</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-7">sdk</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Looker40SDK</span><span class="hl-1">(</span><span class="hl-4">lookerSession</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-7">response</span><span class="hl-1"> = </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-4">sdk</span><span class="hl-1">.</span><span class="hl-0">ok</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-4">sdk</span><span class="hl-1">.</span><span class="hl-0">acquire_embed_cookieless_session</span><span class="hl-1">(</span><span class="hl-4">request</span><span class="hl-1">, {</span><br/><span class="hl-1">        </span><span class="hl-4">headers:</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-2">&#39;User-Agent&#39;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-4">userAgent</span><span class="hl-1">,</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">      })</span><br/><span class="hl-1">    )</span><br/><span class="hl-1">    </span><span class="hl-6">// Note the cachekey includes the embed user id and user agent.</span><br/><span class="hl-1">    </span><span class="hl-6">// This allows the embed user to use different browsers at the</span><br/><span class="hl-1">    </span><span class="hl-6">// same time. Note that a cache is not the only way to save the</span><br/><span class="hl-1">    </span><span class="hl-6">// embed session information, the hosting applications user session</span><br/><span class="hl-1">    </span><span class="hl-6">// can also be used (and probably should be).</span><br/><span class="hl-1">    </span><span class="hl-4">embedSessions</span><span class="hl-1">[</span><span class="hl-4">cacheKey</span><span class="hl-1">] = </span><span class="hl-4">response</span><br/><span class="hl-1">    </span><span class="hl-3">const</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-7">authentication_token</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">authentication_token_ttl</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">navigation_token</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">navigation_token_ttl</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">session_reference_token_ttl</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">api_token</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">api_token_ttl</span><span class="hl-1">,</span><br/><span class="hl-1">    } = </span><span class="hl-4">response</span><br/><span class="hl-1">    </span><span class="hl-6">// Important. Do not return the entire response to the client! The response</span><br/><span class="hl-1">    </span><span class="hl-6">// contains the session_reference_token. This token MUST be kept secure.</span><br/><span class="hl-1">    </span><span class="hl-5">return</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">api_token</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">api_token_ttl</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">authentication_token</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">authentication_token_ttl</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">navigation_token</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">navigation_token_ttl</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">session_reference_token_ttl</span><span class="hl-1">,</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  } </span><span class="hl-5">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">&#39;embed session acquire failed&#39;</span><span class="hl-1">, { </span><span class="hl-4">error</span><span class="hl-1"> })</span><br/><span class="hl-1">    </span><span class="hl-5">throw</span><span class="hl-1"> </span><span class="hl-4">error</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code></pre>

<a href="#generate-tokens-backend-process" id="generate-tokens-backend-process" style="color: inherit; text-decoration: none;">
  <h3>Generate tokens backend process</h3>
</a>
<p>This process is called whenever tokens are about to expire and can be called after a token has expired (for example, a user waking up computer that has gone to sleep). The generate tokens backend process requires that the Looker api endpoint <code>generate_tokens_for_cookieless_session</code> be called to generate new navigation and api tokens.</p>
<p>Cookieless embed sessions are associated with the user&#39;s browser user agent. It is important that that user agent for the browser be included in the request.</p>
<p>This is very simplistic implementation for demonstration purposes only. An actual implementation should be a lot more robust. If the embed session has expired,
the <code>session_reference_token_ttl</code> value will be set to 0. When this happens, embedded IFRAMEs can no longer be used and are locked from further interaction.</p>
<pre><code class="language-javascript"><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-0">get</span><span class="hl-1">(</span><span class="hl-2">&#39;/generate-embed-tokens&#39;</span><span class="hl-1">, </span><span class="hl-3">async</span><span class="hl-1"> </span><span class="hl-3">function</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-5">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-7">tokens</span><span class="hl-1"> = </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-0">generateEmbedTokens</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">headers</span><span class="hl-1">[</span><span class="hl-2">&#39;user-agent&#39;</span><span class="hl-1">], </span><span class="hl-4">user</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-0">json</span><span class="hl-1">(</span><span class="hl-4">tokens</span><span class="hl-1">)</span><br/><span class="hl-1">  } </span><span class="hl-5">catch</span><span class="hl-1"> (</span><span class="hl-4">err</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-0">status</span><span class="hl-1">(</span><span class="hl-8">400</span><span class="hl-1">).</span><span class="hl-0">send</span><span class="hl-1">({ </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-4">err</span><span class="hl-1">.</span><span class="hl-4">message</span><span class="hl-1"> })</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">})</span><br/><br/><span class="hl-5">export</span><span class="hl-1"> </span><span class="hl-3">async</span><span class="hl-1"> </span><span class="hl-3">function</span><span class="hl-1"> </span><span class="hl-0">generateEmbedTokens</span><span class="hl-1">(</span><span class="hl-4">userAgent</span><span class="hl-1">, </span><span class="hl-4">user</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-7">cacheKey</span><span class="hl-1"> = </span><span class="hl-2">`</span><span class="hl-3">${</span><span class="hl-4">user</span><span class="hl-9">.</span><span class="hl-4">external_user_id</span><span class="hl-3">}</span><span class="hl-2">/</span><span class="hl-3">${</span><span class="hl-4">userAgent</span><span class="hl-3">}</span><span class="hl-2">`</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-7">embedSession</span><span class="hl-1"> = </span><span class="hl-4">embedSessions</span><span class="hl-1">[</span><span class="hl-4">cacheKey</span><span class="hl-1">]</span><br/><span class="hl-1">  </span><span class="hl-5">if</span><span class="hl-1"> (!</span><span class="hl-4">embedSession</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-2">&#39;embed session generate tokens failed, session not yet acquired&#39;</span><br/><span class="hl-1">    )</span><br/><span class="hl-1">    </span><span class="hl-5">throw</span><span class="hl-1"> </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-10">Error</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-2">&#39;embed session generate tokens failed, session not yet acquired&#39;</span><br/><span class="hl-1">    )</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-0">acquireLookerSession</span><span class="hl-1">()</span><br/><span class="hl-1">  </span><span class="hl-5">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">const</span><span class="hl-1"> { </span><span class="hl-7">api_token</span><span class="hl-1">, </span><span class="hl-7">navigation_token</span><span class="hl-1">, </span><span class="hl-7">session_reference_token</span><span class="hl-1"> } =</span><br/><span class="hl-1">      </span><span class="hl-4">embedSession</span><br/><span class="hl-1">    </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-7">sdk</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Looker40SDK</span><span class="hl-1">(</span><span class="hl-4">lookerSession</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-7">response</span><span class="hl-1"> = </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-4">sdk</span><span class="hl-1">.</span><span class="hl-0">ok</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-4">sdk</span><span class="hl-1">.</span><span class="hl-0">generate_tokens_for_cookieless_session</span><span class="hl-1">(</span><br/><span class="hl-1">        {</span><br/><span class="hl-1">          </span><span class="hl-4">api_token</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">navigation_token</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">session_reference_token:</span><span class="hl-1"> </span><span class="hl-4">session_reference_token</span><span class="hl-1"> || </span><span class="hl-2">&#39;&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">        {</span><br/><span class="hl-1">          </span><span class="hl-4">headers:</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-2">&#39;User-Agent&#39;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-4">userAgent</span><span class="hl-1">,</span><br/><span class="hl-1">          },</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      )</span><br/><span class="hl-1">    )</span><br/><span class="hl-1">    </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-7">cacheKey</span><span class="hl-1"> = </span><span class="hl-2">`</span><span class="hl-3">${</span><span class="hl-4">user</span><span class="hl-9">.</span><span class="hl-4">external_user_id</span><span class="hl-3">}</span><span class="hl-2">/</span><span class="hl-3">${</span><span class="hl-4">userAgent</span><span class="hl-3">}</span><span class="hl-2">`</span><br/><span class="hl-1">    </span><span class="hl-4">embedSessions</span><span class="hl-1">[</span><span class="hl-4">cacheKey</span><span class="hl-1">] = </span><span class="hl-4">response</span><br/><span class="hl-1">    </span><span class="hl-5">return</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">api_token:</span><span class="hl-1"> </span><span class="hl-4">response</span><span class="hl-1">.</span><span class="hl-4">api_token</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">api_token_ttl:</span><span class="hl-1"> </span><span class="hl-4">response</span><span class="hl-1">.</span><span class="hl-4">api_token_ttl</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">navigation_token:</span><span class="hl-1"> </span><span class="hl-4">response</span><span class="hl-1">.</span><span class="hl-4">navigation_token</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">navigation_token_ttl:</span><span class="hl-1"> </span><span class="hl-4">response</span><span class="hl-1">.</span><span class="hl-4">navigation_token_ttl</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">session_reference_token_ttl:</span><span class="hl-1"> </span><span class="hl-4">response</span><span class="hl-1">.</span><span class="hl-4">session_reference_token_ttl</span><span class="hl-1">,</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  } </span><span class="hl-5">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">&#39;embed session generate tokens failed&#39;</span><span class="hl-1">, { </span><span class="hl-4">error</span><span class="hl-1"> })</span><br/><span class="hl-1">    </span><span class="hl-5">throw</span><span class="hl-1"> </span><span class="hl-4">error</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code></pre>

<a href="#initializing-the-embed-sdk-in-the-frontend" id="initializing-the-embed-sdk-in-the-frontend" style="color: inherit; text-decoration: none;">
  <h3>Initializing the Embed SDK in the frontend</h3>
</a>
<p>Cookieless embed is initialized by calling <code>getEmbedSDK().initCookieless(...)</code> passing in the Looker host value and the urls of the backend endpoints described previously. Once a Looker embed IFRAME is created it will communicate with the Embed SDK running in the host application and use the callbacks appropriately.</p>
<pre><code class="language-javascript"><span class="hl-0">getEmbedSDK</span><span class="hl-1">().</span><span class="hl-0">initCookieless</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-2">&#39;looker.example.com&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&#39;/acquire-embed-session&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&#39;/generate-embed-tokens&#39;</span><br/><span class="hl-1">)</span>
</code></pre>

<a href="#embed-domain-allow-list" id="embed-domain-allow-list" style="color: inherit; text-decoration: none;">
  <h3>Embed domain allow list</h3>
</a>
<p>Looker embed SSO requires that the host application domain be added to an allow list using the Looker configure admin page. Starting with Looker version <code>23.8</code>, the embed domain can be specified in the payload of the <code>acquire_embed_cookieless_session</code> call. This allows customers to dynamically specify the allowed domains. The allowed domain is associated with the embed session stored in the Looker server and is NOT persisted to the internal Looker database. This means that the embed domain must be included with every <code>acquire_embed_cookieless_session</code> call.</p>
<p>When implementing it is HIGHLY recommended that the implementor NOT trust any embed domain sent from the browser (in other words do not use the location.origin from the browser). Instead, the embed application should implement a mechanism in the server that maps a user to particular domain.</p>
<p>To add the embed domain to the <code>acquire_embed_cookieless_session</code> payload set the <code>LOOKER_USE_EMBED_DOMAIN</code> variable to true in the <code>.env</code> file</p>

<a href="#demonstration-application" id="demonstration-application" style="color: inherit; text-decoration: none;">
  <h2>Demonstration Application</h2>
</a>
<p>The <code>./demo</code> directory contains the frontend code for an embedded application. The following features can demonstrated:</p>
<ol>
<li>Signed URL embedding using a single IFRAME. Multiple Looker object types and instances can be loaded using a single IFRAME.</li>
<li>Signed URL embedding using multiple IFRAMEs. An IFRAME can be created for a dashboard, look, explore and/extension.</li>
<li>Cookieless embedding using a single IFRAME. Multiple Looker object types and instances can be loaded using a single IFRAME.</li>
<li>Cookieless embedding using multiple IFRAMEs. An IFRAME can be created for a dashboard, look, explore and/extension.</li>
<li>Embed Message API embedding (this is provided for information purposes only and demonstrates how to embed Looker without using the Embed SDK).</li>
</ol>

<a href="#step-1---enable-embedding-in-your-looker-instance" id="step-1---enable-embedding-in-your-looker-instance" style="color: inherit; text-decoration: none;">
  <h3>Step 1 - Enable Embedding in your Looker instance</h3>
</a>
<p>Enabling signed URL embedding is documented in more detail <a href="https://cloud.google.com/looker/docs/single-sign-on-embedding">here</a>.
Enabling cookieless embedding is documented in more detail <a href="https://cloud.google.com/looker/docs/r/sdk/cookieless-embed">here</a>.</p>
<ul>
<li>Navigate to Admin &gt; <em>Platform</em> Embed on your Looker instance. This requires Admin privileges.</li>
<li>The demo server runs by default at <a href="http://localhost:8080">http://localhost:8080</a>. By adding that address to the &quot;Embedded Domain Allowlist&quot; you can enable the demo to receive messages from Looker.</li>
<li>Turn on &quot;Embed SSO Authentication&quot;</li>
<li>In order to use embedding you must generate an &quot;Embed Secret&quot; for SSO embedding and/or a JWT secret for cookieless embedding. A Looker instance can support signed URL and cookieless embedding simultaneously.</li>
</ul>
<p>Additional steps to activate cookieless embed:</p>
<ul>
<li>Navigate to <code>Admin &gt; Platform &gt; Embed</code> on your Looker instance. This requires Admin privileges.</li>
<li>Enable Cookieless Embed.</li>
<li>Generate an Embed JWT secret. This is used internally and the hosting application does not need to know what it is.</li>
</ul>

<a href="#step-2---customize-the-demo-settings-for-your-looker-instance" id="step-2---customize-the-demo-settings-for-your-looker-instance" style="color: inherit; text-decoration: none;">
  <h3>Step 2 - Customize the Demo settings for your Looker instance</h3>
</a>
<p>The embed demo environment can be configured using a <code>.env</code> file. The following is a template that can be used to create the file (in the root of this repo). The <code>.env</code> file should never be stored in your git repo and is included in the repo&#39;s <code>.gitignore</code> file.</p>
<pre><code class="language-shell"><span class="hl-6"># Demo Server Configuration</span><br/><br/><span class="hl-6"># Protocol for the demo server to listen</span><br/><span class="hl-6"># http or https. Use https if Reports are to be embedded</span><br/><span class="hl-1">LOOKER_DEMO_PROTOCOL=http</span><br/><span class="hl-6"># Allow server to be called using a URL other than localhost or 127,0.0.1</span><br/><span class="hl-6"># Set to true when developing Embedded Reports</span><br/><span class="hl-1">LOOKER_DEMO_HOST_EXTERNAL=false</span><br/><span class="hl-6"># Looker Web Server (omit the protocol)</span><br/><span class="hl-6"># LOOKER_EMBED_HOST can also be used</span><br/><span class="hl-1">LOOKER_WEB_URL=mycompany.looker.com</span><br/><span class="hl-6"># Looker API server (include the protocol)</span><br/><span class="hl-6"># LOOKER_EMBED_API_URL can also be used</span><br/><span class="hl-1">LOOKER_API_URL=https://mycompany.looker.com:19999</span><br/><span class="hl-6"># Host name for the demo server</span><br/><span class="hl-1">LOOKER_DEMO_HOST=localhost</span><br/><span class="hl-6"># Port for the demo server</span><br/><span class="hl-1">LOOKER_DEMO_PORT=8080</span><br/><span class="hl-6"># Demo server cookie secret (used to encrypt the cookie)</span><br/><span class="hl-1">COOKIE_SECRET=cookie_stash</span><br/><span class="hl-6"># Verify the Looker certificate (for most embed developers, the Looker certificate will be valid)</span><br/><span class="hl-1">LOOKER_VERIFY_SSL=true</span><br/><br/><span class="hl-6"># Looker Embed Configuration</span><br/><br/><span class="hl-6"># Embed type to demo</span><br/><span class="hl-6"># signed - use signed embedding</span><br/><span class="hl-6"># cookieless - use cookieless embedding</span><br/><span class="hl-6"># private - use private embedding</span><br/><span class="hl-1">LOOKER_EMBED_TYPE=signed</span><br/><span class="hl-6"># Looker embed secret - from /admin/embed page</span><br/><span class="hl-1">LOOKER_EMBED_SECRET=</span><br/><span class="hl-6"># Looker client id - from /admin/users/api3_key/{id}</span><br/><span class="hl-1">LOOKER_CLIENT_ID=</span><br/><span class="hl-6"># Looker client secret - from /admin/users/api3_key/{id}</span><br/><span class="hl-1">LOOKER_CLIENT_SECRET=</span><br/><span class="hl-6"># Use dynamic embed domains for cookieless embed</span><br/><span class="hl-1">LOOKER_USE_EMBED_DOMAIN=false</span><br/><br/><span class="hl-6"># Looker Embed Data Configuration</span><br/><span class="hl-6"># Set to - if demo needs to ignore it</span><br/><br/><span class="hl-6"># Dashboard IDs</span><br/><span class="hl-1">LOOKER_DASHBOARD_ID=1</span><br/><span class="hl-1">LOOKER_DASHBOARD_ID_2=2</span><br/><span class="hl-6"># Look ID</span><br/><span class="hl-1">LOOKER_LOOK_ID=1</span><br/><span class="hl-6"># Explore ID</span><br/><span class="hl-1">LOOKER_EXPLORE_ID=thelook::orders</span><br/><span class="hl-6"># Extension ID</span><br/><span class="hl-1">LOOKER_EXTENSION_ID=extension::my-great-extension</span><br/><span class="hl-6"># Report ID</span><br/><span class="hl-1">LOOKER_REPORT_ID=aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee</span><br/><span class="hl-6"># Query Visualization ID</span><br/><span class="hl-1">LOOKER_QUERY_VISUALIZATION_ID=1234567890ABCDEF123456</span>
</code></pre>
<ul>
<li>Edit the <code>demo/demo_user.json</code> file to be appropriate for the type of user you want to embed. Normally your backend service would use information about the user logged into your embedding application to inform Looker about important user properties that control data access controls. The <code>demo/demo_user.json</code> file is also used for cookieless embedding. Remember that cookieless_embed always treats <code>force_logout_login</code> as <code>true</code>. See <a href="https://cloud.google.com/looker/docs/single-sign-on-embedding">documentation</a> for detailed information on the content of the embed user definition.</li>
</ul>
<pre><code class="language-javascript"><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-6">// External embed user ID. IDs are not shared with regular users. Required</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;external_user_id&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;user1&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-6">// First and last name. Optional</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;first_name&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Pat&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;last_name&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Embed&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-6">// Duration before session expires, in seconds. Required.</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;session_length&quot;</span><span class="hl-1">: </span><span class="hl-8">3600</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-6">// Enforce logging in with these permissions. Recommended.</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;force_logout_login&quot;</span><span class="hl-1">: </span><span class="hl-3">true</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-6">// External embed group ID. Optional.</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;external_group_id&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;group1&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-6">// Looker Group IDs. Optional</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;group_ids&quot;</span><span class="hl-1">: [],</span><br/><span class="hl-1">  </span><span class="hl-6">// Permissions. See documentation for details. Required.</span><br/><span class="hl-1">  </span><span class="hl-6">// Can any combination of:</span><br/><span class="hl-1">  </span><span class="hl-6">//   &#39;access_data&#39;</span><br/><span class="hl-1">  </span><span class="hl-6">//   &#39;see_lookml_dashboards&#39;</span><br/><span class="hl-1">  </span><span class="hl-6">//   &#39;see_looks&#39;</span><br/><span class="hl-1">  </span><span class="hl-6">//   &#39;see_user_dashboards&#39;</span><br/><span class="hl-1">  </span><span class="hl-6">//   &#39;explore&#39;</span><br/><span class="hl-1">  </span><span class="hl-6">//   &#39;create_table_calculations&#39;</span><br/><span class="hl-1">  </span><span class="hl-6">//   &#39;create_custom_fields&#39;</span><br/><span class="hl-1">  </span><span class="hl-6">//   &#39;can_create_forecast&#39;</span><br/><span class="hl-1">  </span><span class="hl-6">//   &#39;save_content&#39;</span><br/><span class="hl-1">  </span><span class="hl-6">//   &#39;send_outgoing_webhook&#39;</span><br/><span class="hl-1">  </span><span class="hl-6">//   &#39;send_to_s3&#39;</span><br/><span class="hl-1">  </span><span class="hl-6">//   &#39;send_to_sftp&#39;</span><br/><span class="hl-1">  </span><span class="hl-6">//   &#39;schedule_look_emails&#39;</span><br/><span class="hl-1">  </span><span class="hl-6">//   &#39;schedule_external_look_emails&#39;</span><br/><span class="hl-1">  </span><span class="hl-6">//   &#39;send_to_integration&#39;</span><br/><span class="hl-1">  </span><span class="hl-6">//   &#39;create_alerts&#39;</span><br/><span class="hl-1">  </span><span class="hl-6">//   &#39;download_with_limit&#39;</span><br/><span class="hl-1">  </span><span class="hl-6">//   &#39;download_without_limit&#39;</span><br/><span class="hl-1">  </span><span class="hl-6">//   &#39;see_sql&#39;</span><br/><span class="hl-1">  </span><span class="hl-6">//   &#39;clear_cache_refresh&#39;</span><br/><span class="hl-1">  </span><span class="hl-6">//   &#39;see_drill_overlay&#39;</span><br/><span class="hl-1">  </span><span class="hl-6">//   &#39;embed_browse_spaces&#39;</span><br/><span class="hl-1">  </span><span class="hl-6">//   &#39;embed_save_shared_space&#39;</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;permissions&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;access_data&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;see_looks&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;see_user_dashboards&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;explore&quot;</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;save_content&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;embed_browse_spaces&quot;</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><span class="hl-6">// Model access permissions. Required.</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;models&quot;</span><span class="hl-1">: [</span><span class="hl-2">&quot;powered_by&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;thelook&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-6">// User attributes. Optional.</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;user_attributes&quot;</span><span class="hl-1">: { </span><span class="hl-2">&quot;locale&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-2">&quot;en_US&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-6">// Access filters. Optional.</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;access_filters&quot;</span><span class="hl-1">: { </span><span class="hl-2">&quot;powered_by&quot;</span><span class="hl-4">:</span><span class="hl-1"> { </span><span class="hl-2">&quot;products.brand&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-2">&quot;Allegra K&quot;</span><span class="hl-1"> } }</span><br/><span class="hl-1">}</span>
</code></pre>

<a href="#step-3---build-and-run-the-demo" id="step-3---build-and-run-the-demo" style="color: inherit; text-decoration: none;">
  <h3>Step 3 - Build and run the demo</h3>
</a>
<p>Run the following commands from the top-level embed-sdk directory.</p>
<ul>
<li><code>npm install</code></li>
<li><code>npm run server</code></li>
<li>The server will listen on port 8080.</li>
</ul>

<a href="#logging" id="logging" style="color: inherit; text-decoration: none;">
  <h3>Logging</h3>
</a>
<p>The Embed SDK is built on top of <a href="https://github.com/looker-open-source/chatty">chatty</a>. Chatty uses <a href="https://github.com/visionmedia/debug">debug</a> for logging. You can enable logging
in a browser console with</p>
<pre><code class="language-javascript"><span class="hl-4">localStorage</span><span class="hl-1">.</span><span class="hl-4">debug</span><span class="hl-1"> = </span><span class="hl-2">&#39;looker:chatty:*&#39;</span>
</code></pre>
<p>The hosting window and the embedded IFRAME have separate local storage, so you can enable logging on one, the other, or both. You can disable logging with</p>
<pre><code class="language-javascript"><span class="hl-4">localStorage</span><span class="hl-1">.</span><span class="hl-4">debug</span><span class="hl-1"> = </span><span class="hl-3">undefined</span>
</code></pre>

<a href="#embedded-javascript-events" id="embedded-javascript-events" style="color: inherit; text-decoration: none;">
  <h2>Embedded Javascript Events</h2>
</a>
<p>Prior to the release of the Embed SDK, Looker exposed an API that utilized JavaScript <code>postMessage</code> events. This API is still available for customers who cannot or do not want to use the Embed SDK (using the Embed SDK is highly recommended as it provides additional functionality and is simpler to use). An example application has been created to ensure that cookieless embed also works with JavaScript <code>postMessage</code> events. This example can be found <a href="demo/message_example.ts">here</a>.</p>

<a href="#additional-considerations" id="additional-considerations" style="color: inherit; text-decoration: none;">
  <h2>Additional Considerations</h2>
</a>

<a href="#embedded-reports" id="embedded-reports" style="color: inherit; text-decoration: none;">
  <h2>Embedded Reports</h2>
</a>
<p>Beginning with Embed SDK 2.0.0 and Looker 25.6, Looker supports the embedding of Report content. Due to the complexities of some of the CSP checking for Embedded Studio Reports in Looker some additional setup needs to be undertaken by the embed developers wishing to embed Reports.</p>
<ol>
<li>Development servers must run on https. If the embed demo server is being used, set the <code>.env</code> LOOKER_DEMO_PROTOCOL variable to https. If you intend to use <code>npm run server</code> you will need to generate an SSL certificate and a private key. See below for instuctions on how to do this.</li>
<li>The development server must run on a subdomain of the domain that the Looker server is running on. This can be simulated by adding the subdomain and domain to your <code>/etc/hosts</code> file. If the embed demo server is being used, set the <code>.env</code> LOOKER_DEMO_HOST_EXTERNAL variable to true. This allows the demo server to accept connections from the required URL. If the demo server is being used an invalid certificate will be generated. You will need to type <code>thisisunsafe</code> when accessing the server through a chrome browser.</li>
</ol>

<a href="#generate-an-ssl-certificate-and-private-key" id="generate-an-ssl-certificate-and-private-key" style="color: inherit; text-decoration: none;">
  <h3>Generate an SSL certificate and private key</h3>
</a>
<p>The following commands will generate a certificate and private key that can be used to have the demo server use https. Note that the certificate is for development purposes only and the browser will warn you that the certificate is invalid when it connects to the server. Click advanced and type &quot;thisisunsafe&quot; in order to continue (if using chrome).</p>

<a href="#generate-a-certificate" id="generate-a-certificate" style="color: inherit; text-decoration: none;">
  <h4>Generate a certificate</h4>
</a>
<p><code>openssl req -x509 -newkey rsa:2048 -keyout server/keytmp.pem -out server/cert.pem -days 365</code></p>
<p>Enter the PEM pass phrase and remember it (it is needed to generate the key).
Enter or accept the defaults for all of the following prompts.</p>

<a href="#generate-a-key" id="generate-a-key" style="color: inherit; text-decoration: none;">
  <h4>Generate a key</h4>
</a>
<p><code>openssl rsa -in server/keytmp.pem -out server/key.pem</code></p>
<p>The demo server may now be started using the command <code>npm start server</code>.</p>

<a href="#navigating-to-different-content-using-loadurl-loaddashboard-loadlook-loadreport-etc" id="navigating-to-different-content-using-loadurl-loaddashboard-loadlook-loadreport-etc" style="color: inherit; text-decoration: none;">
  <h2>Navigating to different content using loadUrl, loadDashboard, loadLook, loadReport etc</h2>
</a>
<p>Prior to Embed SDK 2.0.0 the <code>loadDashboard</code> method allowed embedding applications to navigate between dashboards. The Looker server would prevent navigation if the dashboard was being edited. With Embed SDK 2.0.0, the Looker server no longer prevents navigation if a Dashboard is being edited (or for that matter if a Look is being edited). Instead, if the host application wants to prevent navigation if a dashboard or look is being edited, it can query the connection to see if an edit is in progress. Example:</p>
<pre><code><span class="hl-5">if</span><span class="hl-1"> (</span><span class="hl-4">embedConnection</span><span class="hl-1">?.</span><span class="hl-0">isEditing</span><span class="hl-1">()) {</span><br/><span class="hl-1">  </span><span class="hl-0">updateStatus</span><span class="hl-1">(</span><span class="hl-2">&#39;Navigation not allowed while editing&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">} </span><span class="hl-5">else</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">embedConnection</span><span class="hl-1">.</span><span class="hl-0">loadDashboard</span><span class="hl-1">(</span><span class="hl-2">&#39;42&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">}</span>
</code></pre>

<a href="#dynamic-dashboard-height" id="dynamic-dashboard-height" style="color: inherit; text-decoration: none;">
  <h2>Dynamic dashboard height</h2>
</a>
<p>The IFRAMEs containing dashboards can be resized to reflect the height of the embedded dashboard. This allows the IFRAME to own the scrollbar rather than the embedded dashboard. To implement dynamic dashboard heights, listen to <code>page:properties:changed</code> events and use the height to set the IFRAME height. Example:</p>
<pre><code class="language-javascript"><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-0">pagePropertiesChangedHandler</span><span class="hl-1"> = (</span><br/><span class="hl-1">  { </span><span class="hl-4">height</span><span class="hl-1"> }: </span><span class="hl-10">PagePropertiesChangedEvent</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">elementId</span><span class="hl-1">: </span><span class="hl-10">string</span><br/><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">if</span><span class="hl-1"> (</span><span class="hl-4">height</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">height</span><span class="hl-1"> &gt; </span><span class="hl-8">100</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-7">element</span><span class="hl-1"> = </span><span class="hl-4">document</span><span class="hl-1">.</span><span class="hl-0">querySelector</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-2">`#</span><span class="hl-3">${</span><span class="hl-4">elementId</span><span class="hl-3">}</span><span class="hl-2"> iframe`</span><br/><span class="hl-1">    ) </span><span class="hl-5">as</span><span class="hl-1"> </span><span class="hl-10">HTMLIFrameElement</span><br/><span class="hl-1">    </span><span class="hl-5">if</span><span class="hl-1"> (</span><span class="hl-4">element</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">element</span><span class="hl-1">.</span><span class="hl-4">style</span><span class="hl-1">.</span><span class="hl-4">height</span><span class="hl-1"> = </span><span class="hl-2">`</span><span class="hl-3">${</span><span class="hl-4">height</span><span class="hl-3">}</span><span class="hl-2">px`</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><br/><br/><span class="hl-0">getEmbedSDK</span><span class="hl-1">().</span><span class="hl-0">createDashboardWithId</span><span class="hl-1">(</span><span class="hl-4">runtimeConfig</span><span class="hl-1">.</span><span class="hl-4">dashboardId</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">appendTo</span><span class="hl-1">(</span><span class="hl-2">&#39;#dashboard&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">on</span><span class="hl-1">(</span><span class="hl-2">&#39;page:properties:changed&#39;</span><span class="hl-1">, (</span><span class="hl-4">event</span><span class="hl-1">: </span><span class="hl-10">PagePropertiesChangedEvent</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">pagePropertiesChangedHandler</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">, </span><span class="hl-2">&#39;dashboard&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  })</span><br/><span class="hl-1">  .</span><span class="hl-0">build</span><span class="hl-1">()</span><br/><span class="hl-1">  .</span><span class="hl-0">connect</span><span class="hl-1">()</span>
</code></pre>
<p>The Embed SDK also contains a convenience method to add this functionality for you. Example:</p>
<pre><code class="language-javascript"><span class="hl-0">getEmbedSDK</span><span class="hl-1">()</span><br/><span class="hl-1">  .</span><span class="hl-0">createDashboardWithId</span><span class="hl-1">(</span><span class="hl-2">&#39;42&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">withDynamicIFrameHeight</span><span class="hl-1">()</span><br/><span class="hl-1">  .</span><span class="hl-0">appendTo</span><span class="hl-1">(</span><span class="hl-2">&#39;#dashboard&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">build</span><span class="hl-1">()</span><br/><span class="hl-1">  .</span><span class="hl-0">connect</span><span class="hl-1">()</span>
</code></pre>

<a href="#full-screen-tile-visualizations" id="full-screen-tile-visualizations" style="color: inherit; text-decoration: none;">
  <h3>Full screen tile visualizations</h3>
</a>
<p>Looker has the capability to display individual tile visualizations in full screen mode. This feature works for embedded IFRAMEs but the <code>fullscreen</code> feature MUST be added to the containing IFRAME. Version 1.8.2 of the Embed SDK was updated to allow features to be added. The following example shows how to enable support for full screen mode.</p>
<pre><code class="language-javascript"><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-7">connection</span><span class="hl-1"> = </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-0">getEmbedSDK</span><span class="hl-1">()</span><br/><span class="hl-1">  .</span><span class="hl-0">createDashboardWithId</span><span class="hl-1">(</span><span class="hl-4">runtimeConfig</span><span class="hl-1">.</span><span class="hl-4">dashboardId</span><span class="hl-1">)</span><br/><span class="hl-1">  </span><span class="hl-6">// Allow fullscreen tile visualizations</span><br/><span class="hl-1">  .</span><span class="hl-0">withAllowAttr</span><span class="hl-1">(</span><span class="hl-2">&#39;fullscreen&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  </span><span class="hl-6">// Append to the #dashboard element</span><br/><span class="hl-1">  .</span><span class="hl-0">appendTo</span><span class="hl-1">(</span><span class="hl-2">&#39;#dashboard&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  </span><span class="hl-6">// Finalize the build</span><br/><span class="hl-1">  .</span><span class="hl-0">build</span><span class="hl-1">()</span><br/><span class="hl-1">  </span><span class="hl-6">// Connect to Looker</span><br/><span class="hl-1">  .</span><span class="hl-0">connect</span><span class="hl-1">()</span>
</code></pre>

<a href="#tile-dialogs" id="tile-dialogs" style="color: inherit; text-decoration: none;">
  <h3>Tile dialogs</h3>
</a>
<p>Users have the capability of opening dialogs from a dashboard tile. One downside of opening the dialogs is that unexpected scrolling can occur. With Looker 23.6+ it is now possible to mitigate the scrolling using the Embed SDK. Example:</p>
<pre><code class="language-javascript"><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-7">connection</span><span class="hl-1"> = </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-0">getEmbedSDK</span><span class="hl-1">()</span><br/><span class="hl-1">  .</span><span class="hl-0">createDashboardWithId</span><span class="hl-1">(</span><span class="hl-4">runtimeConfig</span><span class="hl-1">.</span><span class="hl-4">dashboardId</span><span class="hl-1">)</span><br/><span class="hl-1">  </span><span class="hl-6">// Scrolls the top of the IFRAME into view when drilling</span><br/><span class="hl-1">  .</span><span class="hl-0">withDialogScroll</span><span class="hl-1">()</span><br/><span class="hl-1">  </span><span class="hl-6">// Ensures that the tile download and tile alert dialogs remain in view</span><br/><span class="hl-1">  .</span><span class="hl-0">withScrollMonitor</span><span class="hl-1">()</span><br/><span class="hl-1">  </span><span class="hl-6">// Append to the #dashboard element</span><br/><span class="hl-1">  .</span><span class="hl-0">appendTo</span><span class="hl-1">(</span><span class="hl-2">&#39;#dashboard&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  </span><span class="hl-6">// Finalize the build</span><br/><span class="hl-1">  .</span><span class="hl-0">build</span><span class="hl-1">()</span><br/><span class="hl-1">  </span><span class="hl-6">// Connect to Looker</span><br/><span class="hl-1">  .</span><span class="hl-0">connect</span><span class="hl-1">()</span>
</code></pre>
<p>This functionality is also available to the javascript API. See <a href="demo/message_example.ts">here</a> for how to add this functionality.</p>
</div></div><div class="col-4 col-menu menu-sticky-wrap menu-highlight"><nav class="tsd-navigation primary"><ul><li class="current"><a href="modules.html">Exports</a></li></ul></nav><nav class="tsd-navigation secondary menu-sticky"><ul><li class="tsd-kind-class"><a href="classes/LookerEmbedExSDK.html" class="tsd-kind-icon">Looker<wbr/>Embed<wbr/>ExSDK</a></li><li class="tsd-kind-class"><a href="classes/LookerEmbedSDK.html" class="tsd-kind-icon">Looker<wbr/>EmbedSDK</a></li><li class="tsd-kind-interface"><a href="interfaces/AddFilterJson.html" class="tsd-kind-icon">Add<wbr/>Filter<wbr/>Json</a></li><li class="tsd-kind-interface"><a href="interfaces/CancellableEventResponse.html" class="tsd-kind-icon">Cancellable<wbr/>Event<wbr/>Response</a></li><li class="tsd-kind-interface"><a href="interfaces/CookielessRequestInit.html" class="tsd-kind-icon">Cookieless<wbr/>Request<wbr/>Init</a></li><li class="tsd-kind-interface"><a href="interfaces/DashboardEvent.html" class="tsd-kind-icon">Dashboard<wbr/>Event</a></li><li class="tsd-kind-interface"><a href="interfaces/DashboardEventDetail.html" class="tsd-kind-icon">Dashboard<wbr/>Event<wbr/>Detail</a></li><li class="tsd-kind-interface"><a href="interfaces/DashboardLayout.html" class="tsd-kind-icon">Dashboard<wbr/>Layout</a></li><li class="tsd-kind-interface"><a href="interfaces/DashboardLayoutComponent.html" class="tsd-kind-icon">Dashboard<wbr/>Layout<wbr/>Component</a></li><li class="tsd-kind-interface"><a href="interfaces/DashboardTileDownloadEvent.html" class="tsd-kind-icon">Dashboard<wbr/>Tile<wbr/>Download<wbr/>Event</a></li><li class="tsd-kind-interface"><a href="interfaces/DashboardTileEvent.html" class="tsd-kind-icon">Dashboard<wbr/>Tile<wbr/>Event</a></li><li class="tsd-kind-interface"><a href="interfaces/DashboardTileEventDetail.html" class="tsd-kind-icon">Dashboard<wbr/>Tile<wbr/>Event<wbr/>Detail</a></li><li class="tsd-kind-interface"><a href="interfaces/DashboardTileExploreEvent.html" class="tsd-kind-icon">Dashboard<wbr/>Tile<wbr/>Explore<wbr/>Event</a></li><li class="tsd-kind-interface"><a href="interfaces/DashboardTileViewEvent.html" class="tsd-kind-icon">Dashboard<wbr/>Tile<wbr/>View<wbr/>Event</a></li><li class="tsd-kind-interface"><a href="interfaces/DrillMenuEvent.html" class="tsd-kind-icon">Drill<wbr/>Menu<wbr/>Event</a></li><li class="tsd-kind-interface"><a href="interfaces/DrillModalDownloadEvent.html" class="tsd-kind-icon">Drill<wbr/>Modal<wbr/>Download<wbr/>Event</a></li><li class="tsd-kind-interface"><a href="interfaces/DrillModalExploreEvent.html" class="tsd-kind-icon">Drill<wbr/>Modal<wbr/>Explore<wbr/>Event</a></li><li class="tsd-kind-interface"><a href="interfaces/ElementOptionItems.html" class="tsd-kind-icon">Element<wbr/>Option<wbr/>Items</a></li><li class="tsd-kind-interface"><a href="interfaces/ElementOptions.html" class="tsd-kind-icon">Element<wbr/>Options</a></li><li class="tsd-kind-interface"><a href="interfaces/EmbedBuilder.html" class="tsd-kind-icon">Embed<wbr/>Builder</a></li><li class="tsd-kind-interface"><a href="interfaces/EmbedClient.html" class="tsd-kind-icon">Embed<wbr/>Client</a></li><li class="tsd-kind-interface"><a href="interfaces/EnvClientDialogEvent.html" class="tsd-kind-icon">Env<wbr/>Client<wbr/>Dialog<wbr/>Event</a></li><li class="tsd-kind-interface"><a href="interfaces/EnvHostScrollEvent.html" class="tsd-kind-icon">Env<wbr/>Host<wbr/>Scroll<wbr/>Event</a></li><li class="tsd-kind-interface"><a href="interfaces/EventDetail.html" class="tsd-kind-icon">Event<wbr/>Detail</a></li><li class="tsd-kind-interface"><a href="interfaces/ExploreEvent.html" class="tsd-kind-icon">Explore<wbr/>Event</a></li><li class="tsd-kind-interface"><a href="interfaces/ExploreEventDetail.html" class="tsd-kind-icon">Explore<wbr/>Event<wbr/>Detail</a></li><li class="tsd-kind-interface"><a href="interfaces/IConnectOptions.html" class="tsd-kind-icon">IConnect<wbr/>Options</a></li><li class="tsd-kind-interface"><a href="interfaces/IEmbedBuilder.html" class="tsd-kind-icon">IEmbed<wbr/>Builder</a></li><li class="tsd-kind-interface"><a href="interfaces/IEmbedClient.html" class="tsd-kind-icon">IEmbed<wbr/>Client</a></li><li class="tsd-kind-interface"><a href="interfaces/ILookerConnection.html" class="tsd-kind-icon">ILooker<wbr/>Connection</a></li><li class="tsd-kind-interface"><a href="interfaces/ILookerEmbedDashboard.html" class="tsd-kind-icon">ILooker<wbr/>Embed<wbr/>Dashboard</a></li><li class="tsd-kind-interface"><a href="interfaces/ILookerEmbedExplore.html" class="tsd-kind-icon">ILooker<wbr/>Embed<wbr/>Explore</a></li><li class="tsd-kind-interface"><a href="interfaces/ILookerEmbedExtension.html" class="tsd-kind-icon">ILooker<wbr/>Embed<wbr/>Extension</a></li><li class="tsd-kind-interface"><a href="interfaces/ILookerEmbedLook.html" class="tsd-kind-icon">ILooker<wbr/>Embed<wbr/>Look</a></li><li class="tsd-kind-interface"><a href="interfaces/ILookerEmbedQueryVisualization.html" class="tsd-kind-icon">ILooker<wbr/>Embed<wbr/>Query<wbr/>Visualization</a></li><li class="tsd-kind-interface"><a href="interfaces/ILookerEmbedReport.html" class="tsd-kind-icon">ILooker<wbr/>Embed<wbr/>Report</a></li><li class="tsd-kind-interface"><a href="interfaces/ILookerEmbedSDK.html" class="tsd-kind-icon">ILooker<wbr/>EmbedSDK</a></li><li class="tsd-kind-interface"><a href="interfaces/LookEditCancelEvent.html" class="tsd-kind-icon">Look<wbr/>Edit<wbr/>Cancel<wbr/>Event</a></li><li class="tsd-kind-interface"><a href="interfaces/LookEditEventDetail.html" class="tsd-kind-icon">Look<wbr/>Edit<wbr/>Event<wbr/>Detail</a></li><li class="tsd-kind-interface"><a href="interfaces/LookEditStartEvent.html" class="tsd-kind-icon">Look<wbr/>Edit<wbr/>Start<wbr/>Event</a></li><li class="tsd-kind-interface"><a href="interfaces/LookEvent.html" class="tsd-kind-icon">Look<wbr/>Event</a></li><li class="tsd-kind-interface"><a href="interfaces/LookEventDetail.html" class="tsd-kind-icon">Look<wbr/>Event<wbr/>Detail</a></li><li class="tsd-kind-interface"><a href="interfaces/LookSaveEvent.html" class="tsd-kind-icon">Look<wbr/>Save<wbr/>Event</a></li><li class="tsd-kind-interface"><a href="interfaces/LookSaveEventDetail.html" class="tsd-kind-icon">Look<wbr/>Save<wbr/>Event<wbr/>Detail</a></li><li class="tsd-kind-interface"><a href="interfaces/LookerAuthConfig.html" class="tsd-kind-icon">Looker<wbr/>Auth<wbr/>Config</a></li><li class="tsd-kind-interface"><a href="interfaces/LookerDashboardOptions.html" class="tsd-kind-icon">Looker<wbr/>Dashboard<wbr/>Options</a></li><li class="tsd-kind-interface"><a href="interfaces/LookerEmbedBase.html" class="tsd-kind-icon">Looker<wbr/>Embed<wbr/>Base</a></li><li class="tsd-kind-interface"><a href="interfaces/LookerEmbedCookielessSessionData.html" class="tsd-kind-icon">Looker<wbr/>Embed<wbr/>Cookieless<wbr/>Session<wbr/>Data</a></li><li class="tsd-kind-interface"><a href="interfaces/LookerEmbedCookielessTokenData.html" class="tsd-kind-icon">Looker<wbr/>Embed<wbr/>Cookieless<wbr/>Token<wbr/>Data</a></li><li class="tsd-kind-interface"><a href="interfaces/LookerEmbedDashboard.html" class="tsd-kind-icon">Looker<wbr/>Embed<wbr/>Dashboard</a></li><li class="tsd-kind-interface"><a href="interfaces/LookerEmbedEvent.html" class="tsd-kind-icon">Looker<wbr/>Embed<wbr/>Event</a></li><li class="tsd-kind-interface"><a href="interfaces/LookerEmbedEventMap.html" class="tsd-kind-icon">Looker<wbr/>Embed<wbr/>Event<wbr/>Map</a></li><li class="tsd-kind-interface"><a href="interfaces/LookerEmbedExplore.html" class="tsd-kind-icon">Looker<wbr/>Embed<wbr/>Explore</a></li><li class="tsd-kind-interface"><a href="interfaces/LookerEmbedExtension.html" class="tsd-kind-icon">Looker<wbr/>Embed<wbr/>Extension</a></li><li class="tsd-kind-interface"><a href="interfaces/LookerEmbedFilterParams.html" class="tsd-kind-icon">Looker<wbr/>Embed<wbr/>Filter<wbr/>Params</a></li><li class="tsd-kind-interface"><a href="interfaces/LookerEmbedLook.html" class="tsd-kind-icon">Looker<wbr/>Embed<wbr/>Look</a></li><li class="tsd-kind-interface"><a href="interfaces/PageChangedEvent.html" class="tsd-kind-icon">Page<wbr/>Changed<wbr/>Event</a></li><li class="tsd-kind-interface"><a href="interfaces/PageChangedEventDetail.html" class="tsd-kind-icon">Page<wbr/>Changed<wbr/>Event<wbr/>Detail</a></li><li class="tsd-kind-interface"><a href="interfaces/PagePropertiesChangedEvent.html" class="tsd-kind-icon">Page<wbr/>Properties<wbr/>Changed<wbr/>Event</a></li><li class="tsd-kind-interface"><a href="interfaces/QueryError.html" class="tsd-kind-icon">Query<wbr/>Error</a></li><li class="tsd-kind-interface"><a href="interfaces/SessionStatus.html" class="tsd-kind-icon">Session<wbr/>Status</a></li><li class="tsd-kind-interface"><a href="interfaces/TileStatus.html" class="tsd-kind-icon">Tile<wbr/>Status</a></li><li class="tsd-kind-interface"><a href="interfaces/UrlParams.html" class="tsd-kind-icon">Url<wbr/>Params</a></li><li class="tsd-kind-interface"><a href="interfaces/VisConfig.html" class="tsd-kind-icon">Vis<wbr/>Config</a></li><li class="tsd-kind-type-alias"><a href="modules.html#CookielessCallback" class="tsd-kind-icon">Cookieless<wbr/>Callback</a></li><li class="tsd-kind-type-alias"><a href="modules.html#GenerateTokensCallback" class="tsd-kind-icon">Generate<wbr/>Tokens<wbr/>Callback</a></li><li class="tsd-kind-type-alias"><a href="modules.html#LoadIdParams" class="tsd-kind-icon">Load<wbr/>Id<wbr/>Params</a></li><li class="tsd-kind-type-alias"><a href="modules.html#LoadUrlParams" class="tsd-kind-icon">Load<wbr/>Url<wbr/>Params</a></li><li class="tsd-kind-type-alias"><a href="modules.html#PageType" class="tsd-kind-icon">Page<wbr/>Type</a></li><li class="tsd-kind-type-alias"><a href="modules.html#SessionTokenRequest" class="tsd-kind-icon">Session<wbr/>Token<wbr/>Request</a></li><li class="tsd-kind-function"><a href="modules.html#getEmbedSDK" class="tsd-kind-icon">get<wbr/>EmbedSDK</a></li></ul></nav></div></div></div><footer class="with-border-bottom"><div class="container"><h2>Legend</h2><div class="tsd-legend-group"><ul class="tsd-legend"><li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li><li class="tsd-kind-method tsd-parent-kind-interface"><span class="tsd-kind-icon">Method</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-constructor tsd-parent-kind-class"><span class="tsd-kind-icon">Constructor</span></li><li class="tsd-kind-method tsd-parent-kind-class"><span class="tsd-kind-icon">Method</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-method tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static method</span></li></ul></div><h2>Settings</h2><p>Theme <select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></p></div></footer><div class="container tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div><script src="assets/main.js"></script></body></html>