<!DOCTYPE html><html class="default"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@looker/embed-sdk</title><meta name="description" content="Documentation for @looker/embed-sdk"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.body.classList.add(localStorage.getItem("tsd-theme") || "os")</script><header><div class="tsd-page-toolbar"><div class="container"><div class="table-wrap"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption">Search</label><input type="text" id="tsd-search-field"/></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">@looker/embed-sdk</a></div><div class="table-cell" id="tsd-widgets"><div id="tsd-filter"><a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a><div class="tsd-filter-group"><div class="tsd-select" id="tsd-filter-visibility"><span class="tsd-select-label">All</span><ul class="tsd-select-list"><li data-value="public">Public</li><li data-value="protected">Public/Protected</li><li data-value="private" class="selected">All</li></ul></div> <input type="checkbox" id="tsd-filter-inherited" checked/><label class="tsd-widget" for="tsd-filter-inherited">Inherited</label><input type="checkbox" id="tsd-filter-externals" checked/><label class="tsd-widget" for="tsd-filter-externals">Externals</label></div></div><a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a></div></div></div></div><div class="tsd-page-title"><div class="container"><h1>@looker/embed-sdk </h1></div></div></header><div class="container container-main"><div class="row"><div class="col-8 col-content"><div class="tsd-panel tsd-typography">
<a href="#looker-javascript-embed-sdk" id="looker-javascript-embed-sdk" style="color: inherit; text-decoration: none;">
  <h1>Looker JavaScript Embed SDK</h1>
</a>

<a href="#introduction" id="introduction" style="color: inherit; text-decoration: none;">
  <h2>Introduction</h2>
</a>
<p>The Looker JavaScript Embed SDK is designed to facilitate using Looker embedded content in your web application. The goal is to make communication between a host website and one or more embedded dashboards, looks, explores and extensions easier and more reliable.</p>
<p>The Looker JavaScript Embed SDK typically uses embed SSO to sign an embed url in order to authenticate the user of the embed. This mechanism relies on Looker cookies being available to the embedded IFRAME in order for the application to work. Looker also provides a mechanism that allows embedded Looker IFRAMES to work without the need for cookies. Details can be found <a href="#cookieless">here</a>. Embed SDK functionality that will not work with cookieless embed is identified in this document.</p>
<p>A typical setup might look like this. In this case, a dashboard with an id of <code>11</code> is created inside a DOM element with the id <code>dashboard</code>. The <code>dashboard:run:start</code> and <code>dashboard:run:complete</code> events are used to update the state of the embedding window&#39;s UI, and a button with an id of <code>run</code> is scripted to send a <code>dashboard:run</code> message to the dashboard.</p>
<pre><code class="language-javascript"><span class="hl-0">LookerEmbedSDK</span><span class="hl-1">.</span><span class="hl-2">init</span><span class="hl-1">(</span><span class="hl-3">&#39;looker.example.com&#39;</span><span class="hl-1">, </span><span class="hl-3">&#39;/auth&#39;</span><span class="hl-1">)</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-2">setupDashboard</span><span class="hl-1"> = (</span><span class="hl-0">dashboard</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">document</span><span class="hl-1">.</span><span class="hl-2">querySelector</span><span class="hl-1">(</span><span class="hl-3">&#39;#run&#39;</span><span class="hl-1">).</span><span class="hl-2">addEventListener</span><span class="hl-1">(</span><span class="hl-3">&#39;click&#39;</span><span class="hl-1">, () </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">dashboard</span><span class="hl-1">.</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">&#39;dashboard:run&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  })</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-0">LookerEmbedSDK</span><span class="hl-1">.</span><span class="hl-2">createDashboardWithId</span><span class="hl-1">(</span><span class="hl-5">11</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-2">appendTo</span><span class="hl-1">(</span><span class="hl-3">&#39;#dashboard&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-2">on</span><span class="hl-1">(</span><span class="hl-3">&#39;dashboard:run:start&#39;</span><span class="hl-1">, () </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">updateState</span><span class="hl-1">(</span><span class="hl-3">&#39;#dashboard-state&#39;</span><span class="hl-1">, </span><span class="hl-3">&#39;Running&#39;</span><span class="hl-1">))</span><br/><span class="hl-1">  .</span><span class="hl-2">on</span><span class="hl-1">(</span><span class="hl-3">&#39;dashboard:run:complete&#39;</span><span class="hl-1">, () </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">updateState</span><span class="hl-1">(</span><span class="hl-3">&#39;#dashboard-state&#39;</span><span class="hl-1">, </span><span class="hl-3">&#39;Done&#39;</span><span class="hl-1">))</span><br/><span class="hl-1">  .</span><span class="hl-2">build</span><span class="hl-1">()</span><br/><span class="hl-1">  .</span><span class="hl-2">connect</span><span class="hl-1">()</span><br/><span class="hl-1">  .</span><span class="hl-2">then</span><span class="hl-1">(</span><span class="hl-0">setupDashboard</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-2">catch</span><span class="hl-1">((</span><span class="hl-0">error</span><span class="hl-1">: </span><span class="hl-6">Error</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-2">error</span><span class="hl-1">(</span><span class="hl-3">&#39;An unexpected error occurred&#39;</span><span class="hl-1">, </span><span class="hl-0">error</span><span class="hl-1">)</span><br/><span class="hl-1">  })</span>
</code></pre>
<p>A more complete example can be found <a href="demo/demo.ts">here</a>. Detailed instructions on how to use it are <a href="#demo">here</a>.</p>

<a href="#details" id="details" style="color: inherit; text-decoration: none;">
  <h2>Details</h2>
</a>
<p>The Looker Embed SDK uses a fluent interface pattern. The construction of the embedded content is broken into two phases, building and connecting.</p>

<a href="#building" id="building" style="color: inherit; text-decoration: none;">
  <h3>Building</h3>
</a>
<p>First initialize the SDK with address of your Looker server and the endpoint on your server that will perform authentication. (Note: Port must be included if it is required to reach the Looker server from browser clients, e.g. looker.example.com:1919, but the protocol (http/https) should <em>not</em> be included.)</p>
<pre><code class="language-javascript"><span class="hl-0">LookerEmbedSDK</span><span class="hl-1">.</span><span class="hl-2">init</span><span class="hl-1">(</span><span class="hl-3">&#39;looker.example.com&#39;</span><span class="hl-1">, </span><span class="hl-3">&#39;/auth&#39;</span><span class="hl-1">)</span>
</code></pre>
<p>In this example, <code>/auth</code> is a backend service that you must implement as described in the <a href="#the-auth-endpoint">Auth</a> section.</p>
<p>After the SDK is initialized, begin by creating the builder with an <code>id</code>. For example, to create a dashboard embed builder:</p>
<pre><code class="language-javascript"><span class="hl-0">LookerEmbedSDK</span><span class="hl-1">.</span><span class="hl-2">createDashboardWithId</span><span class="hl-1">(</span><span class="hl-0">id</span><span class="hl-1">)</span>
</code></pre>
<p>You can then add additional attributes to the builder to complete your setup:</p>
<pre><code class="language-javascript"><span class="hl-1">  .</span><span class="hl-2">appendTo</span><span class="hl-1">(</span><span class="hl-3">&#39;#dashboard&#39;</span><span class="hl-1">)</span>
</code></pre>
<p>You can add event handlers:</p>
<pre><code class="language-javascript"><span class="hl-1">  .</span><span class="hl-2">on</span><span class="hl-1">(</span><span class="hl-3">&#39;dashboard:run:start&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      () </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">updateState</span><span class="hl-1">(</span><span class="hl-3">&#39;#dashboard-state&#39;</span><span class="hl-1">, </span><span class="hl-3">&#39;Running&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  )</span><br/><span class="hl-1">  .</span><span class="hl-2">on</span><span class="hl-1">(</span><span class="hl-3">&#39;dashboard:run:complete&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      () </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">updateState</span><span class="hl-1">(</span><span class="hl-3">&#39;#dashboard-state&#39;</span><span class="hl-1">, </span><span class="hl-3">&#39;Done&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  )</span>
</code></pre>
<p>You finish by building the embedded element:</p>
<pre><code class="language-javascript"><span class="hl-1">  .</span><span class="hl-2">build</span><span class="hl-1">()</span>
</code></pre>
<p>The <code>createDashboardWithId</code> function will call your backend <code>/auth</code> endpoint when <code>build</code> is invoked and requires a signed embed URL in response. Subsequent embeds can be generated using <code>createDashboardWithUrl</code> which accepts a partial URL matching <a href="https://docs.looker.com/reference/embedding/sso-embed#building_the_embed_url">this form</a>, for example: <code>/embed/dashboards/</code>. The URL create functions will not call your backend <code>/auth</code> service. If you are embedding multiple items on a single page, use ID create functions first and then URL create functions subsequently to avoid redundant calls to your auth backend.</p>
<p>If you want to send and receive messages to the embedded element you need to call <code>connect()</code> which returns a Promise that resolves to the communication interface of the given element:</p>
<pre><code class="language-javascript"><span class="hl-1">  .</span><span class="hl-2">connect</span><span class="hl-1">()</span><br/><span class="hl-1">  .</span><span class="hl-2">then</span><span class="hl-1">(</span><span class="hl-0">setupDashboard</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-2">catch</span><span class="hl-1">(</span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">)</span>
</code></pre>

<a href="#building-urls-for-the-sdk" id="building-urls-for-the-sdk" style="color: inherit; text-decoration: none;">
  <h2>Building URLs for the SDK</h2>
</a>
<p>This section does not apply to cookieless embed as building URLs in this manner is not supported. See the <a href="#cookieless">cookieless embed</a> section for details.</p>
<p>The main documentation for Looker SSO embed URLs is <a href="https://docs.looker.com/r/sdk/sso-embed">here</a>. The only difference when creating URLs for the SDK is that you will need to add an <code>sdk=2</code> parameter to the Embed URL alongside other parameters like filters and the <code>embed_domain</code> parameter. This parameter allows Looker to identify that the SDK is present and can take advantage of additional features provided by the SDK.</p>
<pre><code class="language-html"><span class="hl-1">/embed/looks/4?embed_domain=https://mywebsite.com =&gt;</span><br/><span class="hl-1">/embed/looks/4?embed_domain=https://mywebsite.com&amp;sdk=2</span>
</code></pre>
<p>The SDK cannot add this parameter itself because it part of the signed SSO URL.</p>

<a href="#the-auth-endpoint" id="the-auth-endpoint" style="color: inherit; text-decoration: none;">
  <h2>The Auth Endpoint</h2>
</a>
<p>This section does not apply to cookieless embed as an alternate mechanism for authentication is used. See the <a href="#cookieless">cookieless embed</a> section for details.</p>
<p>In order to use the embed SDK on the frontend you must supply a backend service that handles authentication. This service is called by the SDK to generate a signed iframe URL that is unique to the requesting user. The backend process can either generate the signed embed URL itself using an embed secret or the backend process can generate the URL by calling the Looker API. Manual URL generation and signing avoids calling the Looker API resulting in decreased latency. Calling the Looker API requires less code and can be easier to maintain.</p>

<a href="#backend-process" id="backend-process" style="color: inherit; text-decoration: none;">
  <h3>Backend Process</h3>
</a>
<p>This section does not apply to cookieless embed but a backend process is still required. See the <a href="#cookieless">cookieless embed</a> section for details.</p>
<p>The <em>backend</em> process entails hosting a service at an endpoint such as <code>/auth</code> which does the following:</p>
<ol>
<li><p>The backend service initializes the <a href="https://cloud.google.com/looker/docs/api-sdk">Looker API SDK</a> based on a client API key and secret typically stored in <code>Looker.ini</code> file.</p>
</li>
<li><p>The Embed SDK calls the backend service and provides a query string containing the desired embedding.</p>
</li>
<li><p>The backend service takes the information from the Embed SDK <em>along with any information about the currently authenticated user</em> and generates the signed URL. For example, this Python code represents a partial example of a backend that generates the signed URL by calling the Looker API:</p>
</li>
</ol>
<pre><code class="language-python"><span class="hl-7"># receives a request path that includes /looker_auth</span><br/><span class="hl-7"># as well as the target URL in a query string</span><br/><span class="hl-1">req_parts = urlparse(request_path)</span><br/><span class="hl-1">req_query = parse_qs(req_parts.query)</span><br/><span class="hl-1">embed_url = req_query[</span><span class="hl-3">&#39;src&#39;</span><span class="hl-1">][</span><span class="hl-5">0</span><span class="hl-1">]</span><br/><span class="hl-1">target_url =  </span><span class="hl-3">&#39;https://&#39;</span><span class="hl-1"> + LOOKER_HOST +  </span><span class="hl-3">&#39;/login/embed/&#39;</span><span class="hl-1"> + urllib.parse.quote_plus(embed_url)</span><br/><span class="hl-1">target_sso_url = looker_sdk.models.EmbedSsoParams(target_url, ...) </span><span class="hl-7"># ... corresponds to very important user attributes</span><br/><span class="hl-1">sso_url = looker_api_sdk.create_sso_embed_url(</span><span class="hl-0">body</span><span class="hl-1"> = target_sso_url) </span><span class="hl-7"># this is the signed embed URL that is returned</span>
</code></pre>

<a href="#frontend-process" id="frontend-process" style="color: inherit; text-decoration: none;">
  <h3>Frontend Process</h3>
</a>
<p>This section does not apply to cookieless embed but frontend initialization is still required. See the <a href="#cookieless">cookieless embed</a> section for details.</p>
<p>The <em>frontend</em> process using the Embed SDK entails:</p>
<ol>
<li>The embed SDK is initialized with the Looker host and the backend service:</li>
</ol>
<pre><code class="language-javascript"><span class="hl-0">LookerEmbedSDK</span><span class="hl-1">.</span><span class="hl-2">init</span><span class="hl-1">(</span><span class="hl-3">&#39;looker.example.com&#39;</span><span class="hl-1">, </span><span class="hl-3">&#39;/auth&#39;</span><span class="hl-1">)</span>
</code></pre>
<ol start="2">
<li>Anytime you invoke a builder with the ID create function the Embed SDK makes a request to the backend, <code>/looker_auth</code>, containing a query string with the desired content embed URL along with any provided parameters:</li>
</ol>
<pre><code class="language-javascript"><span class="hl-0">LookerEmbedSDK</span><span class="hl-1">.</span><span class="hl-2">createDashboardWithId</span><span class="hl-1">(</span><span class="hl-5">11</span><span class="hl-1">).</span><span class="hl-2">build</span><span class="hl-1">()</span><br/><span class="hl-7">// results in a request that includes a query string with:</span><br/><span class="hl-7">// /embed/dashboards/11?sdk=2&amp;embed_deomain=https://yourhost.example.com&amp;...</span>
</code></pre>
<ol start="3">
<li>The Embed SDK inserts an iframe using the signed URL returned from the backend as the src.</li>
</ol>

<a href="#advanced-auth-configuration" id="advanced-auth-configuration" style="color: inherit; text-decoration: none;">
  <h3>Advanced Auth Configuration</h3>
</a>
<p>This section does not apply to cookieless embed as an alternate mechanism for authentication is used. See the <a href="#cookieless">cookieless embed</a> section for details.</p>
<p>The Auth endpoint can be configured further, allowing custom Request Headers, as well as CORS support by passing an options object to the <code>init</code> method</p>
<pre><code class="language-javascript"><span class="hl-0">LookerEmbedSDK</span><span class="hl-1">.</span><span class="hl-2">init</span><span class="hl-1">(</span><span class="hl-3">&#39;looker.example.com&#39;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-0">url:</span><span class="hl-1"> </span><span class="hl-3">&#39;https://api.acme.com/looker/auth&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">headers:</span><span class="hl-1"> [{ </span><span class="hl-0">name:</span><span class="hl-1"> </span><span class="hl-3">&#39;Foo Header&#39;</span><span class="hl-1">, </span><span class="hl-0">value:</span><span class="hl-1"> </span><span class="hl-3">&#39;Foo&#39;</span><span class="hl-1"> }],</span><br/><span class="hl-1">  </span><span class="hl-0">params:</span><span class="hl-1"> [{ </span><span class="hl-0">name:</span><span class="hl-1"> </span><span class="hl-3">&#39;foo&#39;</span><span class="hl-1">, </span><span class="hl-0">value:</span><span class="hl-1"> </span><span class="hl-3">&#39;bar&#39;</span><span class="hl-1"> }],</span><br/><span class="hl-1">  </span><span class="hl-0">withCredentials:</span><span class="hl-1"> </span><span class="hl-4">true</span><span class="hl-1">, </span><span class="hl-7">// Needed for CORS requests to Auth endpoint include Http Only cookie headers</span><br/><span class="hl-1">})</span>
</code></pre>

<a href="#node-helper" id="node-helper" style="color: inherit; text-decoration: none;">
  <h3>Node helper</h3>
</a>
<p>This section does not apply to cookieless embed as an alternate mechanism for authentication is used. See the <a href="#cookieless">cookieless embed</a> section for details.</p>
<p>If you prefer, your backend service can <a href="https://github.com/looker/looker_embed_sso_examples">implement the signature function</a> instead of calling the Looker API by using a <a href="https://docs.looker.com/r/sdk/sso-embed">Looker Embed secret</a>. Manually generating the signed URL avoids a call to the Looker API but is more error prone.</p>
<p>One example of a helper method that generates a signed URL, <code>createSignedUrl()</code>, is provided in
<a href="blob/master/demo/demo_config.ts">server_utils/auth_utils.ts</a>. Its usage is as follows:</p>
<pre><code class="language-javascript"><span class="hl-8">import</span><span class="hl-1"> { </span><span class="hl-0">createSignedUrl</span><span class="hl-1"> } </span><span class="hl-8">from</span><span class="hl-1"> </span><span class="hl-3">&#39;./auth_utils&#39;</span><br/><br/><span class="hl-0">app</span><span class="hl-1">.</span><span class="hl-2">get</span><span class="hl-1">(</span><span class="hl-3">&#39;/looker_auth&#39;</span><span class="hl-1">, </span><span class="hl-4">function</span><span class="hl-1"> (</span><span class="hl-0">req</span><span class="hl-1">, </span><span class="hl-0">res</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-7">// Authenticate the request is from a valid user here</span><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-9">src</span><span class="hl-1"> = </span><span class="hl-0">req</span><span class="hl-1">.</span><span class="hl-0">query</span><span class="hl-1">.</span><span class="hl-0">src</span><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-9">host</span><span class="hl-1"> = </span><span class="hl-3">&#39;looker.example.com&#39;</span><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-9">secret</span><span class="hl-1"> = </span><span class="hl-9">YOUR_EMBED_SECRET</span><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-9">user</span><span class="hl-1"> = </span><span class="hl-0">authenticatedUser</span><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-9">url</span><span class="hl-1"> = </span><span class="hl-2">createSignedUrl</span><span class="hl-1">(</span><span class="hl-0">src</span><span class="hl-1">, </span><span class="hl-0">user</span><span class="hl-1">, </span><span class="hl-0">host</span><span class="hl-1">, </span><span class="hl-0">secret</span><span class="hl-1">)</span><br/><span class="hl-1">  </span><span class="hl-0">res</span><span class="hl-1">.</span><span class="hl-2">json</span><span class="hl-1">({ </span><span class="hl-0">url</span><span class="hl-1"> })</span><br/><span class="hl-1">})</span>
</code></pre>
<p>The <code>user</code> data structure is</p>
<pre><code class="language-typescript"><span class="hl-4">interface</span><span class="hl-1"> </span><span class="hl-6">LookerEmbedUser</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">external_user_id</span><span class="hl-1">: </span><span class="hl-6">string</span><br/><span class="hl-1">  </span><span class="hl-0">first_name</span><span class="hl-1">?: </span><span class="hl-6">string</span><br/><span class="hl-1">  </span><span class="hl-0">last_name</span><span class="hl-1">?: </span><span class="hl-6">string</span><br/><span class="hl-1">  </span><span class="hl-0">session_length</span><span class="hl-1">: </span><span class="hl-6">number</span><br/><span class="hl-1">  </span><span class="hl-0">force_logout_login</span><span class="hl-1">?: </span><span class="hl-6">boolean</span><br/><span class="hl-1">  </span><span class="hl-0">permissions</span><span class="hl-1">: </span><span class="hl-6">LookerUserPermission</span><span class="hl-1">[]</span><br/><span class="hl-1">  </span><span class="hl-0">models</span><span class="hl-1">: </span><span class="hl-6">string</span><span class="hl-1">[]</span><br/><span class="hl-1">  </span><span class="hl-0">group_ids</span><span class="hl-1">?: </span><span class="hl-6">number</span><span class="hl-1">[]</span><br/><span class="hl-1">  </span><span class="hl-0">external_group_id</span><span class="hl-1">?: </span><span class="hl-6">string</span><br/><span class="hl-1">  </span><span class="hl-0">user_attributes</span><span class="hl-1">?: { [</span><span class="hl-0">key</span><span class="hl-1">: </span><span class="hl-6">string</span><span class="hl-1">]: </span><span class="hl-6">any</span><span class="hl-1"> }</span><br/><span class="hl-1">  </span><span class="hl-0">access_filters</span><span class="hl-1">: { [</span><span class="hl-0">key</span><span class="hl-1">: </span><span class="hl-6">string</span><span class="hl-1">]: </span><span class="hl-6">any</span><span class="hl-1"> }</span><br/><span class="hl-1">}</span>
</code></pre>
<p><a name='cookieless' id='cookieless'></a></p>

<a href="#cookieless-embed" id="cookieless-embed" style="color: inherit; text-decoration: none;">
  <h2>Cookieless Embed</h2>
</a>
<p>Note that cookieless embed does not yet support the use of <code>withUrl</code>. An attempt to use this functionality will result in an error being thrown.</p>
<p>Looker cookieless embed allows the Looker application to be embedded by an html page that is served from a different domain than the Looker host. With SSO embed, to avoid third party cookie blocking, the Looker application must be served from a sub domain of the hosting application OR the user must enable third party cookies in the browser. Enabling cookieless embedding is documented in more detail <a href="https://cloud.google.com/looker/docs/r/sdk/cookieless-embed">here</a>. Cookieless embed is available with Looker version 22.20 and above.</p>
<p>Cookieless embed works by using short lived tokens that are kept in the browser and are used to reference the actual session in the Looker server. The Looker UI keeps track of the tokens, and before they expire, requests that the hosting application generate new ones. To this end, the host application is required to implement functionality in the client and in the server.</p>
<p>This functionality will:</p>
<ul>
<li>Acquire a new session either by creating or attaching to an existing session associated with the browser (this allows the user to create new IFRAMEs and use the same session).</li>
<li>Generate new tokens.</li>
</ul>

<a href="#acquire-session-backend-process" id="acquire-session-backend-process" style="color: inherit; text-decoration: none;">
  <h3>Acquire session backend process</h3>
</a>
<p>This process will be called every time a Looker embed IFRAME is created. The acquire session backend process requires that the Looker api endpoint <code>acquire_embed_cookieless_session</code> be called to create an embed session or attach to an existing embed session. This endpoint accepts an embed user definition and creates or updates it. This is similar behavior to the embed SSO login as they both can create and update embed user data.
One major difference in the payloads is that <code>force_logout_login</code> is ignored by <code>acquire_embed_cookieless_session</code>. Cookieless embed logins ALWAYS force logout login (as there should be no Looker cookies this should be a noop).</p>
<p>Cookieless embed sessions are associated with the user&#39;s browser user agent. It is important that that user agent for the browser be set on the request.</p>
<p>If successful, the <code>acquire_embed_cookieless_session</code> returns a number of tokens:</p>
<ul>
<li><code>session_reference_token</code> - this token is used to generate new tokens and created new IFRAMEs. It is important to secure and keep track of this token. It should not be returned to the browser. This token lives for the duration of the session. A new cookieless embed session will need to be created when the <code>session_reference_token</code> expires.</li>
<li><code>authentication_token</code> - this is one time token that has a lifespan of 30 seconds. It is used with the <code>/login/embed/{target}</code> endpoint.</li>
<li><code>navigation_token</code> - this token is used to navigate to different Looker pages in the Looker application. This token lives for 10 minutes.</li>
<li><code>api_token</code> - this token is used for api calls. This token lives for 10 minutes.</li>
</ul>
<p>A time to live for each token is also returned. It is important that the response of the <code>acquire_embed_cookieless_session</code> be returned to the browser with the exception of the <code>session_reference_token</code>. The hosting application MUST keep track of the <code>session_reference_token</code> for each user.</p>
<p>The example shown below is simplistic and uses an in memory cache to keep track of the <code>session_reference_token</code>. In memory caches will not work in clustered environments so use a distributed cache such as <code>redis</code> in production. An alternative is to save the <code>session_reference_token</code> in an encrypted session cookie. The use of session cookies is demonstrated <a href="/server_utils/routes.ts">here</a>.</p>
<pre><code class="language-javascript"><span class="hl-7">// Simple endpoint to acquire an embed session. In this case the user data</span><br/><span class="hl-7">// comes from a configuration file. In a real life application the user data</span><br/><span class="hl-7">// would be derived from the embedding hosts session.</span><br/><span class="hl-0">app</span><span class="hl-1">.</span><span class="hl-2">get</span><span class="hl-1">(</span><span class="hl-3">&#39;/acquire-embed-session&#39;</span><span class="hl-1">, </span><span class="hl-4">async</span><span class="hl-1"> </span><span class="hl-4">function</span><span class="hl-1"> (</span><span class="hl-0">req</span><span class="hl-1">, </span><span class="hl-0">res</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-8">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-9">tokens</span><span class="hl-1"> = </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-2">acquireEmbedSession</span><span class="hl-1">(</span><span class="hl-0">req</span><span class="hl-1">.</span><span class="hl-0">headers</span><span class="hl-1">[</span><span class="hl-3">&#39;user-agent&#39;</span><span class="hl-1">], </span><span class="hl-0">user</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-0">res</span><span class="hl-1">.</span><span class="hl-2">json</span><span class="hl-1">(</span><span class="hl-0">tokens</span><span class="hl-1">)</span><br/><span class="hl-1">  } </span><span class="hl-8">catch</span><span class="hl-1"> (</span><span class="hl-0">err</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-5">400</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-0">message:</span><span class="hl-1"> </span><span class="hl-0">err</span><span class="hl-1">.</span><span class="hl-0">message</span><span class="hl-1"> })</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">})</span><br/><br/><span class="hl-7">// The Looker session. In a real application this should not be a global variable,</span><br/><span class="hl-4">let</span><span class="hl-1"> </span><span class="hl-0">lookerSession</span><br/><br/><span class="hl-7">// A very simple cache for storing embed sessions. In a real life application the</span><br/><span class="hl-7">// embed session should be associated with the embedding application user&#39;s session.</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-9">embedSessions</span><span class="hl-1"> = {}</span><br/><br/><span class="hl-7">// Simple function to acquire a looker session and then acquire an embed</span><br/><span class="hl-7">// session.</span><br/><span class="hl-4">async</span><span class="hl-1"> </span><span class="hl-4">function</span><span class="hl-1"> </span><span class="hl-2">acquireEmbedSession</span><span class="hl-1">(</span><span class="hl-0">userAgent</span><span class="hl-1">, </span><span class="hl-0">user</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-2">acquireLookerSession</span><span class="hl-1">()</span><br/><span class="hl-1">  </span><span class="hl-8">return</span><span class="hl-1"> </span><span class="hl-2">acquireEmbedSessionInternal</span><span class="hl-1">(</span><span class="hl-0">userAgent</span><span class="hl-1">, </span><span class="hl-0">user</span><span class="hl-1">)</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-7">// Simple function to acquire a Looker API session.</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-2">acquireLookerSession</span><span class="hl-1"> = </span><span class="hl-4">async</span><span class="hl-1"> () </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-8">if</span><span class="hl-1"> (!</span><span class="hl-0">lookerSession</span><span class="hl-1"> || !</span><span class="hl-0">lookerSession</span><span class="hl-1">.</span><span class="hl-0">activeToken</span><span class="hl-1">.</span><span class="hl-2">isActive</span><span class="hl-1">()) {</span><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> { </span><span class="hl-9">api_url</span><span class="hl-1">, </span><span class="hl-9">client_id</span><span class="hl-1">, </span><span class="hl-9">client_secret</span><span class="hl-1">, </span><span class="hl-9">verify_ssl</span><span class="hl-1"> } = </span><span class="hl-0">config</span><br/><span class="hl-1">    </span><span class="hl-8">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-9">lookerSettings</span><span class="hl-1"> = </span><span class="hl-2">DefaultSettings</span><span class="hl-1">()</span><br/><span class="hl-1">      </span><span class="hl-0">lookerSettings</span><span class="hl-1">.</span><span class="hl-2">readConfig</span><span class="hl-1"> = () </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-8">return</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-0">client_id</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-0">client_secret</span><span class="hl-1">,</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-0">lookerSettings</span><span class="hl-1">.</span><span class="hl-0">base_url</span><span class="hl-1"> = </span><span class="hl-0">api_url</span><br/><span class="hl-1">      </span><span class="hl-0">lookerSettings</span><span class="hl-1">.</span><span class="hl-0">verify_ssl</span><span class="hl-1"> = </span><span class="hl-0">verify_ssl</span><br/><span class="hl-1">      </span><span class="hl-0">lookerSession</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-2">NodeSession</span><span class="hl-1">(</span><span class="hl-0">lookerSettings</span><span class="hl-1">)</span><br/><span class="hl-1">      </span><span class="hl-0">lookerSession</span><span class="hl-1">.</span><span class="hl-2">login</span><span class="hl-1">()</span><br/><span class="hl-1">    } </span><span class="hl-8">catch</span><span class="hl-1"> (</span><span class="hl-0">error</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-2">error</span><span class="hl-1">(</span><span class="hl-3">&#39;login failed&#39;</span><span class="hl-1">, { </span><span class="hl-0">error</span><span class="hl-1"> })</span><br/><span class="hl-1">      </span><span class="hl-8">throw</span><span class="hl-1"> </span><span class="hl-0">error</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-7">// Simple function to acquire the embed session.</span><br/><span class="hl-7">// Note as an additional layer of security the user agent of users</span><br/><span class="hl-7">// browser is associated with the embed session. It is important</span><br/><span class="hl-7">// that this is available when the embed session is created.</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-2">acquireEmbedSessionInternal</span><span class="hl-1"> = </span><span class="hl-4">async</span><span class="hl-1"> (</span><span class="hl-0">userAgent</span><span class="hl-1">, </span><span class="hl-0">user</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-8">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-9">cacheKey</span><span class="hl-1"> = </span><span class="hl-3">`</span><span class="hl-4">${</span><span class="hl-0">user</span><span class="hl-10">.</span><span class="hl-0">external_user_id</span><span class="hl-4">}</span><span class="hl-3">/</span><span class="hl-4">${</span><span class="hl-0">userAgent</span><span class="hl-4">}</span><span class="hl-3">`</span><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-9">embedSession</span><span class="hl-1"> = </span><span class="hl-0">embedSessions</span><span class="hl-1">[</span><span class="hl-0">cacheKey</span><span class="hl-1">]</span><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-9">request</span><span class="hl-1"> = {</span><br/><span class="hl-1">      ...</span><span class="hl-0">user</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-0">session_reference_token:</span><span class="hl-1"> </span><span class="hl-0">embedSession</span><span class="hl-1">?.</span><span class="hl-0">session_reference_token</span><span class="hl-1">,</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-9">sdk</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-2">Looker40SDK</span><span class="hl-1">(</span><span class="hl-0">lookerSession</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-9">response</span><span class="hl-1"> = </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-0">sdk</span><span class="hl-1">.</span><span class="hl-2">ok</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-0">sdk</span><span class="hl-1">.</span><span class="hl-2">acquire_embed_cookieless_session</span><span class="hl-1">(</span><span class="hl-0">request</span><span class="hl-1">, {</span><br/><span class="hl-1">        </span><span class="hl-0">headers:</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-3">&#39;User-Agent&#39;</span><span class="hl-0">:</span><span class="hl-1"> </span><span class="hl-0">userAgent</span><span class="hl-1">,</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">      })</span><br/><span class="hl-1">    )</span><br/><span class="hl-1">    </span><span class="hl-7">// Note the cachekey includes the embed user id and user agent.</span><br/><span class="hl-1">    </span><span class="hl-7">// This allows the embed user to use different browsers at the</span><br/><span class="hl-1">    </span><span class="hl-7">// same time. Note that a cache is not the only way to save the</span><br/><span class="hl-1">    </span><span class="hl-7">// embed session information, the hosting applications user session</span><br/><span class="hl-1">    </span><span class="hl-7">// can also be used (and probably should be).</span><br/><span class="hl-1">    </span><span class="hl-0">embedSessions</span><span class="hl-1">[</span><span class="hl-0">cacheKey</span><span class="hl-1">] = </span><span class="hl-0">response</span><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-9">authentication_token</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-9">authentication_token_ttl</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-9">navigation_token</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-9">navigation_token_ttl</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-9">session_reference_token_ttl</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-9">api_token</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-9">api_token_ttl</span><span class="hl-1">,</span><br/><span class="hl-1">    } = </span><span class="hl-0">response</span><br/><span class="hl-1">    </span><span class="hl-7">// Important. Do not return the entire response to the client! The response</span><br/><span class="hl-1">    </span><span class="hl-7">// contains the session_reference_token. This token MUST be kept secure.</span><br/><span class="hl-1">    </span><span class="hl-8">return</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">api_token</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-0">api_token_ttl</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-0">authentication_token</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-0">authentication_token_ttl</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-0">navigation_token</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-0">navigation_token_ttl</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-0">session_reference_token_ttl</span><span class="hl-1">,</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  } </span><span class="hl-8">catch</span><span class="hl-1"> (</span><span class="hl-0">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-2">error</span><span class="hl-1">(</span><span class="hl-3">&#39;embed session acquire failed&#39;</span><span class="hl-1">, { </span><span class="hl-0">error</span><span class="hl-1"> })</span><br/><span class="hl-1">    </span><span class="hl-8">throw</span><span class="hl-1"> </span><span class="hl-0">error</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code></pre>

<a href="#generate-tokens-backend-process" id="generate-tokens-backend-process" style="color: inherit; text-decoration: none;">
  <h3>Generate tokens backend process</h3>
</a>
<p>This process is called whenever tokens are about to expire and can be called after a token has expired (for example, a user waking up computer that has gone to sleep). The generate tokens backend process requires that the Looker api endpoint <code>generate_tokens_for_cookieless_session</code> be called to generate new navigation and api tokens.</p>
<p>Cookieless embed sessions are associated with the user&#39;s browser user agent. It is important that that user agent for the browser be included in the request.</p>
<p>This is very simplistic implementation for demonstration purposes only. An actual implementation should be a lot more robust. If the embed session has expired,
the <code>session_reference_token_ttl</code> value will be set to 0. When this happens, embedded IFRAMEs can no longer be used and are locked from further interaction.</p>
<pre><code class="language-javascript"><span class="hl-0">app</span><span class="hl-1">.</span><span class="hl-2">get</span><span class="hl-1">(</span><span class="hl-3">&#39;/generate-embed-tokens&#39;</span><span class="hl-1">, </span><span class="hl-4">async</span><span class="hl-1"> </span><span class="hl-4">function</span><span class="hl-1"> (</span><span class="hl-0">req</span><span class="hl-1">, </span><span class="hl-0">res</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-8">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-9">tokens</span><span class="hl-1"> = </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-2">generateEmbedTokens</span><span class="hl-1">(</span><span class="hl-0">req</span><span class="hl-1">.</span><span class="hl-0">headers</span><span class="hl-1">[</span><span class="hl-3">&#39;user-agent&#39;</span><span class="hl-1">], </span><span class="hl-0">user</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-0">res</span><span class="hl-1">.</span><span class="hl-2">json</span><span class="hl-1">(</span><span class="hl-0">tokens</span><span class="hl-1">)</span><br/><span class="hl-1">  } </span><span class="hl-8">catch</span><span class="hl-1"> (</span><span class="hl-0">err</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-5">400</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-0">message:</span><span class="hl-1"> </span><span class="hl-0">err</span><span class="hl-1">.</span><span class="hl-0">message</span><span class="hl-1"> })</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">})</span><br/><br/><span class="hl-8">export</span><span class="hl-1"> </span><span class="hl-4">async</span><span class="hl-1"> </span><span class="hl-4">function</span><span class="hl-1"> </span><span class="hl-2">generateEmbedTokens</span><span class="hl-1">(</span><span class="hl-0">userAgent</span><span class="hl-1">, </span><span class="hl-0">user</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-9">cacheKey</span><span class="hl-1"> = </span><span class="hl-3">`</span><span class="hl-4">${</span><span class="hl-0">user</span><span class="hl-10">.</span><span class="hl-0">external_user_id</span><span class="hl-4">}</span><span class="hl-3">/</span><span class="hl-4">${</span><span class="hl-0">userAgent</span><span class="hl-4">}</span><span class="hl-3">`</span><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-9">embedSession</span><span class="hl-1"> = </span><span class="hl-0">embedSessions</span><span class="hl-1">[</span><span class="hl-0">cacheKey</span><span class="hl-1">]</span><br/><span class="hl-1">  </span><span class="hl-8">if</span><span class="hl-1"> (!</span><span class="hl-0">embedSession</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-2">error</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-3">&#39;embed session generate tokens failed, session not yet acquired&#39;</span><br/><span class="hl-1">    )</span><br/><span class="hl-1">    </span><span class="hl-8">throw</span><span class="hl-1"> </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">Error</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-3">&#39;embed session generate tokens failed, session not yet acquired&#39;</span><br/><span class="hl-1">    )</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-2">acquireLookerSession</span><span class="hl-1">()</span><br/><span class="hl-1">  </span><span class="hl-8">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> { </span><span class="hl-9">api_token</span><span class="hl-1">, </span><span class="hl-9">navigation_token</span><span class="hl-1">, </span><span class="hl-9">session_reference_token</span><span class="hl-1"> } =</span><br/><span class="hl-1">      </span><span class="hl-0">embedSession</span><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-9">sdk</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-2">Looker40SDK</span><span class="hl-1">(</span><span class="hl-0">lookerSession</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-9">response</span><span class="hl-1"> = </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-0">sdk</span><span class="hl-1">.</span><span class="hl-2">ok</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-0">sdk</span><span class="hl-1">.</span><span class="hl-2">generate_tokens_for_cookieless_session</span><span class="hl-1">(</span><br/><span class="hl-1">        {</span><br/><span class="hl-1">          </span><span class="hl-0">api_token</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-0">navigation_token</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-0">session_reference_token:</span><span class="hl-1"> </span><span class="hl-0">session_reference_token</span><span class="hl-1"> || </span><span class="hl-3">&#39;&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">        {</span><br/><span class="hl-1">          </span><span class="hl-0">headers:</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-3">&#39;User-Agent&#39;</span><span class="hl-0">:</span><span class="hl-1"> </span><span class="hl-0">userAgent</span><span class="hl-1">,</span><br/><span class="hl-1">          },</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      )</span><br/><span class="hl-1">    )</span><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-9">cacheKey</span><span class="hl-1"> = </span><span class="hl-3">`</span><span class="hl-4">${</span><span class="hl-0">user</span><span class="hl-10">.</span><span class="hl-0">external_user_id</span><span class="hl-4">}</span><span class="hl-3">/</span><span class="hl-4">${</span><span class="hl-0">userAgent</span><span class="hl-4">}</span><span class="hl-3">`</span><br/><span class="hl-1">    </span><span class="hl-0">embedSessions</span><span class="hl-1">[</span><span class="hl-0">cacheKey</span><span class="hl-1">] = </span><span class="hl-0">response</span><br/><span class="hl-1">    </span><span class="hl-8">return</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">api_token:</span><span class="hl-1"> </span><span class="hl-0">response</span><span class="hl-1">.</span><span class="hl-0">api_token</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-0">api_token_ttl:</span><span class="hl-1"> </span><span class="hl-0">response</span><span class="hl-1">.</span><span class="hl-0">api_token_ttl</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-0">navigation_token:</span><span class="hl-1"> </span><span class="hl-0">response</span><span class="hl-1">.</span><span class="hl-0">navigation_token</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-0">navigation_token_ttl:</span><span class="hl-1"> </span><span class="hl-0">response</span><span class="hl-1">.</span><span class="hl-0">navigation_token_ttl</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-0">session_reference_token_ttl:</span><span class="hl-1"> </span><span class="hl-0">response</span><span class="hl-1">.</span><span class="hl-0">session_reference_token_ttl</span><span class="hl-1">,</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  } </span><span class="hl-8">catch</span><span class="hl-1"> (</span><span class="hl-0">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-2">error</span><span class="hl-1">(</span><span class="hl-3">&#39;embed session generate tokens failed&#39;</span><span class="hl-1">, { </span><span class="hl-0">error</span><span class="hl-1"> })</span><br/><span class="hl-1">    </span><span class="hl-8">throw</span><span class="hl-1"> </span><span class="hl-0">error</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code></pre>

<a href="#initializing-the-looker-sdk-in-the-frontend" id="initializing-the-looker-sdk-in-the-frontend" style="color: inherit; text-decoration: none;">
  <h3>Initializing the Looker SDK in the frontend</h3>
</a>
<p>Cookieless embed is initialized by calling <code>LookerEmbedSDK.initCookieless</code> passing in the Looker host value and the the urls of the backend endpoints described previously. Once a Looker embed IFRAME is created it will communicate with the Embed SDK running in the host application and use the callbacks appropriately.</p>
<pre><code class="language-javascript"><span class="hl-0">LookerEmbedSDK</span><span class="hl-1">.</span><span class="hl-2">initCookieless</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-3">&#39;looker.example.com&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-3">&#39;/acquire-embed-session&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-3">&#39;/generate-embed-tokens&#39;</span><br/><span class="hl-1">)</span>
</code></pre>

<a href="#embed-domain-allow-list" id="embed-domain-allow-list" style="color: inherit; text-decoration: none;">
  <h3>Embed domain allow list</h3>
</a>
<p>Looker embed SSO requires that the host application domain be added to an allow list using the Looker configure admin page. Starting with Looker version <code>23.8</code>, the embed domain can be specified in the payload of the <code>acquire_embed_cookieless_session</code> call. This allows customers to dynamically specify the allowed domains. Note that the allowed domain is associated with the embed session stored in the Looker server. It is NOT persisted to the internal Looker database. This means that the embed domain must be included with every <code>acquire_embed_cookieless_session</code> call. </p>
<p>When implementing it is HIGHLY recommended that that the implementor
NOT trust any embed domain sent from the browser (in other words do not
use the location.origin from the browser). Instead, the embed application should implement a mechanism in the server that maps a
user to particular domain. </p>
<p>To add the embed domain to the <code>acquire_embed_cookieless_session</code> payload set the <code>LOOKER_USE_EMBED_DOMAIN</code> variable to true in the <code>.env</code> file</p>

<a href="#demo" id="demo" style="color: inherit; text-decoration: none;">
  <h2>Demo</h2>
</a>
<p>A simple demo is provided in the <code>/demo</code> directory that uses a basic JS frontend and a Python backend. The example backend <code>demo.py</code> uses the Looker API to create a signed URL. The example backend <code>demo_self_signed.py</code> uses the embed secret and a helper function to sign the URL. The instructions below are for the example using the Looker API.</p>
<p>The python simple demo server does not support cookieless embed but alternative TypeScript backend is available which does support cookieless embed.</p>

<a href="#step-1---enable-embedding-in-your-looker-instance" id="step-1---enable-embedding-in-your-looker-instance" style="color: inherit; text-decoration: none;">
  <h3>Step 1 - Enable Embedding in your Looker instance</h3>
</a>
<p>Enabling SSO embedding is documented in more detail <a href="https://cloud.google.com/looker/docs/single-sign-on-embedding">here</a>.
Enabling cookieless embedding is documented in more detail <a href="https://cloud.google.com/looker/docs/r/sdk/cookieless-embed">here</a>.</p>
<ul>
<li>Navigate to Admin &gt; <em>Platform</em> Embed on your Looker instance. This requires Admin privileges.</li>
<li>The demo server runs by default at <a href="http://localhost:8080">http://localhost:8080</a>. By adding that address to &quot;Embedded Domain Whitelist&quot; you can enabled the demo to receive messages from Looker.</li>
<li>Turn on &quot;Embed SSO Authentication&quot;</li>
<li>In order to use embedding you must generate an &quot;Embed Secret&quot; for SSO embedding and/or a JWT secret for cookieless embedding. Note that a Looker instance can support both types of embedding at the same time.</li>
</ul>
<p>Additional steps for cookieless embed:</p>
<ul>
<li>Navigate to Admin &gt; <em>Platform</em> Embed on your Looker instance. This requires Admin privileges.</li>
<li>Generate an Embed JWT secret. This is used internally and the hosting application does not need to know what it is.</li>
<li>Navigate to Admin &gt; <em>Labs</em> Experimental on your Looker instance. This requires Admin privileges.</li>
<li>Toggle &quot;Cookieless Embed&quot; on. Note that a Looker instance can support SSO and Cookieless embed clients.</li>
</ul>

<a href="#step-2---customize-the-demo-settings-for-your-looker-instance" id="step-2---customize-the-demo-settings-for-your-looker-instance" style="color: inherit; text-decoration: none;">
  <h3>Step 2 - Customize the Demo settings for your Looker instance</h3>
</a>
<p>Note that <code>demo.py</code> and <code>demo_self_signed.py</code> have NOT been updated to support cookieless embedding. This section ONLY applies to SSO embedding. The cookieless embed demo currently requires the use of the development server.</p>
<ul>
<li><p>If you are using the main <code>demo.py</code>, provide your API credentials to the server by updating <code>demo/looker.ini</code> following <a href="https://community.looker.com/technical-tips-tricks-1021/the-how-to-on-initializing-the-sdk-with-different-profiles-in-your-ini-file-26846">these instructions</a>, with credentials obtained from <a href="https://cloud.google.com/looker/docs/api-auth">the Users page</a>.</p>
</li>
<li><p>Alternatively, if you are using <code>demo_self_signed.py</code>, provide your embed secret to the server. You can do this a couple ways.</p>
<ul>
<li>Set it as <code>LOOKER_EMBED_SECRET</code> in your shell environment.</li>
<li>Create a file named <code>.env</code> in the root of the sdk directory. Add a line to that file: <code>LOOKER_EMBED_SECRET=&quot;YourLookerSecret&quot;</code></li>
</ul>
</li>
<li><p>Another alternative is to use the TypeScript demo server. The embed secret can be provided in the following way:</p>
<ul>
<li>Set it as <code>LOOKER_EMBED_SECRET</code> in your shell environment.</li>
<li>Create a file named <code>.env</code> in the root of the sdk directory. Add a line to that file: <code>LOOKER_EMBED_SECRET=&quot;YourLookerSecret&quot;</code></li>
</ul>
</li>
<li><p>Provide your Looker instance host address to the server:</p>
<ul>
<li>Create a <code>.env</code> file in the main embed-sdk directory and add <code>LOOKER_EMBED_HOST=&quot;yourinstance.looker.com:yourport&quot;</code></li>
<li><strong>The Looker embed host should not include the protocol!</strong></li>
</ul>
</li>
<li><p>Edit the <code>demo/demo_config.ts</code> file to be appropriate for the pages you want to embed. It is also possible to override the <code>demo/demo_config.ts</code> in the <code>.env</code> file. See <a href="#env">here</a> for more details.</p>
</li>
</ul>
<pre><code class="language-javascript"><span class="hl-7">// The address of your Looker instance. Required.</span><br/><span class="hl-7">// Include the port if it is necessary when accessing looker in a browser</span><br/><span class="hl-7">// Do NOT include the protocol</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-9">lookerHost</span><span class="hl-1"> = </span><span class="hl-3">&#39;mycompany.looker.com&#39;</span><br/><br/><span class="hl-7">// A dashboard that the user can see. Set to &#39;-&#39; or &#39;0&#39; to disable dashboard demo.</span><br/><span class="hl-7">// dashboardId can be a numeric id or a slug string.</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-9">dashboardId</span><span class="hl-1"> = </span><span class="hl-5">1</span><br/><br/><span class="hl-7">// A Look that the user can see. Set to 0 to disable look demo.</span><br/><span class="hl-7">// lookId must be numeric. Slugs are NOT supported.</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-9">lookId</span><span class="hl-1"> = </span><span class="hl-5">1</span><br/><br/><span class="hl-7">// An Explore that the user can see. Set to &#39;-&#39; to disable explore demo.</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-9">exploreId</span><span class="hl-1"> = </span><span class="hl-3">&#39;thelook::orders&#39;</span><br/><br/><span class="hl-7">// An Extension that the user can see. Set to &#39;-&#39; to disable extension demo.</span><br/><span class="hl-7">// Requires Looker 7.12 and extensions framework.</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-9">extensionId</span><span class="hl-1"> = </span><span class="hl-3">&#39;extension::my-great-extension&#39;</span>
</code></pre>
<ul>
<li>Edit the <code>demo/demo_user.json</code> file to be appropriate for the type of user you want to embed. Normally your backend service would use information about the user logged into your embedding application (e.g your customer portal) to inform Looker about important user properties that control data access controls. Note that the <code>demo/demo_user.json</code> file is also used for cookieless embedding. The one difference is that cookieless_embed will ignore the value of <code>force_logout_login</code> and will ALWAYs treat the value as <code>true</code>. See <a href="https://cloud.google.com/looker/docs/single-sign-on-embedding">documentation</a> for detailed information on the content of the embed user definition.</li>
</ul>
<pre><code class="language-javascript"><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-7">// External embed user ID. IDs are not shared with regular users. Required</span><br/><span class="hl-1">  </span><span class="hl-3">&quot;external_user_id&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;user1&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-7">// First and last name. Optional</span><br/><span class="hl-1">  </span><span class="hl-3">&quot;first_name&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;Pat&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-3">&quot;last_name&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;Embed&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-7">// Duration before session expires, in seconds. Required.</span><br/><span class="hl-1">  </span><span class="hl-3">&quot;session_length&quot;</span><span class="hl-1">: </span><span class="hl-5">3600</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-7">// Enforce logging in with these permissions. Recommended.</span><br/><span class="hl-1">  </span><span class="hl-3">&quot;force_logout_login&quot;</span><span class="hl-1">: </span><span class="hl-4">true</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-7">// External embed group ID. Optional.</span><br/><span class="hl-1">  </span><span class="hl-3">&quot;external_group_id&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;group1&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-7">// Looker Group IDs. Optional</span><br/><span class="hl-1">  </span><span class="hl-3">&quot;group_ids&quot;</span><span class="hl-1">: [],</span><br/><span class="hl-1">  </span><span class="hl-7">// Permissions. See documentation for details. Required.</span><br/><span class="hl-1">  </span><span class="hl-7">// Can any combination of:</span><br/><span class="hl-1">  </span><span class="hl-7">//   &#39;access_data&#39;</span><br/><span class="hl-1">  </span><span class="hl-7">//   &#39;see_lookml_dashboards&#39;</span><br/><span class="hl-1">  </span><span class="hl-7">//   &#39;see_looks&#39;</span><br/><span class="hl-1">  </span><span class="hl-7">//   &#39;see_user_dashboards&#39;</span><br/><span class="hl-1">  </span><span class="hl-7">//   &#39;explore&#39;</span><br/><span class="hl-1">  </span><span class="hl-7">//   &#39;create_table_calculations&#39;</span><br/><span class="hl-1">  </span><span class="hl-7">//   &#39;create_custom_fields&#39;</span><br/><span class="hl-1">  </span><span class="hl-7">//   &#39;can_create_forecast&#39;</span><br/><span class="hl-1">  </span><span class="hl-7">//   &#39;save_content&#39;</span><br/><span class="hl-1">  </span><span class="hl-7">//   &#39;send_outgoing_webhook&#39;</span><br/><span class="hl-1">  </span><span class="hl-7">//   &#39;send_to_s3&#39;</span><br/><span class="hl-1">  </span><span class="hl-7">//   &#39;send_to_sftp&#39;</span><br/><span class="hl-1">  </span><span class="hl-7">//   &#39;schedule_look_emails&#39;</span><br/><span class="hl-1">  </span><span class="hl-7">//   &#39;schedule_external_look_emails&#39;</span><br/><span class="hl-1">  </span><span class="hl-7">//   &#39;send_to_integration&#39;</span><br/><span class="hl-1">  </span><span class="hl-7">//   &#39;create_alerts&#39;</span><br/><span class="hl-1">  </span><span class="hl-7">//   &#39;download_with_limit&#39;</span><br/><span class="hl-1">  </span><span class="hl-7">//   &#39;download_without_limit&#39;</span><br/><span class="hl-1">  </span><span class="hl-7">//   &#39;see_sql&#39;</span><br/><span class="hl-1">  </span><span class="hl-7">//   &#39;clear_cache_refresh&#39;</span><br/><span class="hl-1">  </span><span class="hl-7">//   &#39;see_drill_overlay&#39;</span><br/><span class="hl-1">  </span><span class="hl-7">//   &#39;embed_browse_spaces&#39;</span><br/><span class="hl-1">  </span><span class="hl-7">//   &#39;embed_save_shared_space&#39;</span><br/><span class="hl-1">  </span><span class="hl-3">&quot;permissions&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">    </span><span class="hl-3">&quot;access_data&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">&quot;see_looks&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">&quot;see_user_dashboards&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">&quot;explore&quot;</span><br/><span class="hl-1">    </span><span class="hl-3">&quot;save_content&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">&quot;embed_browse_spaces&quot;</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><span class="hl-7">// Model access permissions. Required.</span><br/><span class="hl-1">  </span><span class="hl-3">&quot;models&quot;</span><span class="hl-1">: [</span><span class="hl-3">&quot;powered_by&quot;</span><span class="hl-1">, </span><span class="hl-3">&quot;thelook&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-7">// User attributes. Optional.</span><br/><span class="hl-1">  </span><span class="hl-3">&quot;user_attributes&quot;</span><span class="hl-1">: { </span><span class="hl-3">&quot;locale&quot;</span><span class="hl-0">:</span><span class="hl-1"> </span><span class="hl-3">&quot;en_US&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-7">// Access filters. Optional.</span><br/><span class="hl-1">  </span><span class="hl-3">&quot;access_filters&quot;</span><span class="hl-1">: { </span><span class="hl-3">&quot;powered_by&quot;</span><span class="hl-0">:</span><span class="hl-1"> { </span><span class="hl-3">&quot;products.brand&quot;</span><span class="hl-0">:</span><span class="hl-1"> </span><span class="hl-3">&quot;Allegra K&quot;</span><span class="hl-1"> } }</span><br/><span class="hl-1">}</span>
</code></pre>

<a href="#step-3---build-and-run-the-demo" id="step-3---build-and-run-the-demo" style="color: inherit; text-decoration: none;">
  <h3>Step 3 - Build and run the demo</h3>
</a>
<p>The following applies to SSO embed only. Run the following commands from the top-level embed-sdk directory.</p>
<ul>
<li><code>npm install</code></li>
<li><code>npm run python</code></li>
<li>The server will print out what host and port it is running on.</li>
</ul>
<p>If you want to use the <code>demo_self_signed.py</code> example you will need to update <code>packages.json</code> and replace <code>demo.py</code> with <code>demo_self_signed.py</code>.</p>
<p>Alternatively run the TypeScript demo server which also supports cookieless embed.</p>
<ul>
<li><code>npm install</code></li>
<li><code>npm run server</code></li>
<li>The server will listen on port 8080.</li>
</ul>

<a href="#logging" id="logging" style="color: inherit; text-decoration: none;">
  <h3>Logging</h3>
</a>
<p>The Embed SDK is built on top of <a href="https://github.com/looker-open-source/chatty">chatty</a>. Chatty uses <a href="https://github.com/visionmedia/debug">debug</a> for logging. You can enable logging
in a browser console with</p>
<pre><code class="language-javascript"><span class="hl-0">localStorage</span><span class="hl-1">.</span><span class="hl-0">debug</span><span class="hl-1"> = </span><span class="hl-3">&#39;looker:chatty:*&#39;</span>
</code></pre>
<p>Note that both the parent window and the embedded content have separate local storage, so you can enable logging on one, the other or both. You can disable logging with</p>
<pre><code class="language-javascript"><span class="hl-0">localStorage</span><span class="hl-1">.</span><span class="hl-0">debug</span><span class="hl-1"> = </span><span class="hl-3">&#39;&#39;</span>
</code></pre>

<a href="#-env-setup" id="-env-setup" style="color: inherit; text-decoration: none;">
  <h3><a name='env' id='env'></a> <code>.env</code> setup</h3>
</a>
<p>The embed demo environment can be configured using a <code>.env</code> file. The following is a template that can be used to create the file (in the root of this repo). The <code>.env</code> file should never be stored in your git repo and is included in the repo&#39;s <code>.ignore</code> file.</p>
<pre><code class="language-shell"><span class="hl-1">LOOKER_EMBED_HOST=mycompany.looker.com</span><br/><span class="hl-1">LOOKER_EMBED_API_URL=https://mycompany.looker.com:19999</span><br/><span class="hl-1">LOOKER_DEMO_HOST=localhost</span><br/><span class="hl-1">LOOKER_DEMO_PORT=8080</span><br/><span class="hl-1">LOOKER_EMBED_SECRET=</span><br/><span class="hl-1">LOOKER_CLIENT_ID=</span><br/><span class="hl-1">LOOKER_CLIENT_SECRET=</span><br/><span class="hl-1">LOOKER_DASHBOARD_ID=1</span><br/><span class="hl-1">LOOKER_LOOK_ID=1</span><br/><span class="hl-1">LOOKER_EXPLORE_ID=thelook::orders</span><br/><span class="hl-1">LOOKER_EXTENSION_ID=extension::my-great-extension</span><br/><span class="hl-1">COOKIE_SECRET=cookie_stash</span><br/><span class="hl-1">LOOKER_USE_EMBED_DOMAIN=false</span>
</code></pre>

<a href="#embedded-javascript-events" id="embedded-javascript-events" style="color: inherit; text-decoration: none;">
  <h2>Embedded Javascript Events</h2>
</a>
<p>Prior to the release of the Embed SDK, Looker exposed an API that utilized JavaScript <code>postMessage</code> events. This API is still available for customers who cannot or do not want to use the Embed SDK (note that using the Embed SDK is highly recommended as it provides additional functionality and is simpler to use). An example application has been created to ensure that cookieless embed also works with JavaScript <code>postMessage</code> events. This example can be found <a href="demo/message_example.ts">here</a>.</p>

<a href="#additional-considerations" id="additional-considerations" style="color: inherit; text-decoration: none;">
  <h2>Additional Considerations</h2>
</a>

<a href="#dynamic-dashboard-height" id="dynamic-dashboard-height" style="color: inherit; text-decoration: none;">
  <h2>Dynamic dashboard height</h2>
</a>
<p>The IFRAMEs containing dashboards can be resized to reflect the height of the embedded dashboard. This allows the IFRAME to own the scrollbar rather than the embedded dashboard. To implement dynamic dashboard heights, listen to <code>page:properties:changed</code> events and use the height to set the IFRAME height. Example:</p>
<pre><code class="language-javascript"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-2">pagePropertiesChangedHandler</span><span class="hl-1"> = (</span><br/><span class="hl-1">  { </span><span class="hl-0">height</span><span class="hl-1"> }: </span><span class="hl-6">PagePropertiesChangedEvent</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">elementId</span><span class="hl-1">: </span><span class="hl-6">string</span><br/><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-8">if</span><span class="hl-1"> (</span><span class="hl-0">height</span><span class="hl-1"> &amp;&amp; </span><span class="hl-0">height</span><span class="hl-1"> &gt; </span><span class="hl-5">100</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-9">element</span><span class="hl-1"> = </span><span class="hl-0">document</span><span class="hl-1">.</span><span class="hl-2">querySelector</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-3">`#</span><span class="hl-4">${</span><span class="hl-0">elementId</span><span class="hl-4">}</span><span class="hl-3"> iframe`</span><br/><span class="hl-1">    ) </span><span class="hl-8">as</span><span class="hl-1"> </span><span class="hl-6">HTMLIFrameElement</span><br/><span class="hl-1">    </span><span class="hl-8">if</span><span class="hl-1"> (</span><span class="hl-0">element</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">element</span><span class="hl-1">.</span><span class="hl-0">style</span><span class="hl-1">.</span><span class="hl-0">height</span><span class="hl-1"> = </span><span class="hl-3">`</span><span class="hl-4">${</span><span class="hl-0">height</span><span class="hl-4">}</span><span class="hl-3">px`</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><br/><br/><span class="hl-0">LookerEmbedSDK</span><span class="hl-1">.</span><span class="hl-2">createDashboardWithId</span><span class="hl-1">(</span><span class="hl-0">runtimeConfig</span><span class="hl-1">.</span><span class="hl-0">dashboardId</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-2">appendTo</span><span class="hl-1">(</span><span class="hl-3">&#39;#dashboard&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-2">on</span><span class="hl-1">(</span><span class="hl-3">&#39;page:properties:changed&#39;</span><span class="hl-1">, (</span><span class="hl-0">event</span><span class="hl-1">: </span><span class="hl-6">PagePropertiesChangedEvent</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">pagePropertiesChangedHandler</span><span class="hl-1">(</span><span class="hl-0">event</span><span class="hl-1">, </span><span class="hl-3">&#39;dashboard&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  })</span><br/><span class="hl-1">  .</span><span class="hl-2">build</span><span class="hl-1">()</span><br/><span class="hl-1">  .</span><span class="hl-2">connect</span><span class="hl-1">()</span>
</code></pre>
<p>The Embed SDK also contains a convenience method to add this functionality for you. Example:</p>
<pre><code class="language-javascript"><span class="hl-0">LookerEmbedSDK</span><span class="hl-1">.</span><span class="hl-2">createDashboardWithId</span><span class="hl-1">(</span><span class="hl-0">runtimeConfig</span><span class="hl-1">.</span><span class="hl-0">dashboardId</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-2">withDynamicIFrameHeight</span><span class="hl-1">()</span><br/><span class="hl-1">  .</span><span class="hl-2">appendTo</span><span class="hl-1">(</span><span class="hl-3">&#39;#dashboard&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-2">build</span><span class="hl-1">()</span><br/><span class="hl-1">  .</span><span class="hl-2">connect</span><span class="hl-1">()</span>
</code></pre>

<a href="#full-screen-tile-visualizations" id="full-screen-tile-visualizations" style="color: inherit; text-decoration: none;">
  <h3>Full screen tile visualizations</h3>
</a>
<p>Looker has the capability to display individual tile visualizations in full screen mode. This feature works for embedded IFRAMEs but the <code>fullscreen</code> feature MUST be added to the containing IFRAME. Version 1.8.2 of the Embed SDK was updated to allow features to be added. The following example shows how to enable support for full screen mode.</p>
<pre><code class="language-javascript"><span class="hl-1">    </span><span class="hl-0">LookerEmbedSDK</span><span class="hl-1">.</span><span class="hl-2">createDashboardWithId</span><span class="hl-1">(</span><span class="hl-0">runtimeConfig</span><span class="hl-1">.</span><span class="hl-0">dashboardId</span><span class="hl-1">)</span><br/><span class="hl-1">      </span><span class="hl-7">// Allow fullscreen tile visualizations</span><br/><span class="hl-1">      .</span><span class="hl-2">withAllowAttr</span><span class="hl-1">(</span><span class="hl-3">&#39;fullscreen&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">      </span><span class="hl-7">// Append to the #dashboard element</span><br/><span class="hl-1">      .</span><span class="hl-2">appendTo</span><span class="hl-1">(</span><span class="hl-3">&#39;#dashboard&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">      ...</span><br/><span class="hl-1">      </span><span class="hl-7">// Finalize the build</span><br/><span class="hl-1">      .</span><span class="hl-2">build</span><span class="hl-1">()</span><br/><span class="hl-1">      </span><span class="hl-7">// Connect to Looker</span><br/><span class="hl-1">      .</span><span class="hl-2">connect</span><span class="hl-1">()</span><br/><span class="hl-1">      </span><span class="hl-7">// Finish up setup</span><br/><span class="hl-1">      .</span><span class="hl-2">then</span><span class="hl-1">((</span><span class="hl-0">dashboard</span><span class="hl-1">: </span><span class="hl-6">LookerEmbedDashboard</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        ...</span><br/><span class="hl-1">      })</span><br/><span class="hl-1">      .</span><span class="hl-2">catch</span><span class="hl-1">((</span><span class="hl-0">error</span><span class="hl-1">: </span><span class="hl-6">Error</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        ...</span><br/><span class="hl-1">      })</span>
</code></pre>

<a href="#tile-dialogs" id="tile-dialogs" style="color: inherit; text-decoration: none;">
  <h3>Tile dialogs</h3>
</a>
<p>Users have the capability of opening dialogs from a dashboard tile. One downside of opening the dialogs is that unexpected scrolling can occur. With Looker 23.6+ it is now possible to mitigate the scrolling using the Embed SDK. Example:</p>
<pre><code class="language-javascript"><span class="hl-0">LookerEmbedSDK</span><span class="hl-1">.</span><span class="hl-2">createDashboardWithId</span><span class="hl-1">(</span><span class="hl-0">runtimeConfig</span><span class="hl-1">.</span><span class="hl-0">dashboardId</span><span class="hl-1">)</span><br/><span class="hl-1">  </span><span class="hl-7">// Scrolls the top of the IFRAME into view when drilling</span><br/><span class="hl-1">  .</span><span class="hl-2">withDialogScroll</span><span class="hl-1">()</span><br/><span class="hl-1">  </span><span class="hl-7">// Ensures that the tile download and tile alert dialogs remain in view</span><br/><span class="hl-1">  .</span><span class="hl-2">withScrollMonitor</span><span class="hl-1">()</span><br/><span class="hl-1">  </span><span class="hl-7">// Append to the #dashboard element</span><br/><span class="hl-1">  .</span><span class="hl-2">appendTo</span><span class="hl-1">(</span><span class="hl-3">&#39;#dashboard&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  ...</span><br/><span class="hl-1">  </span><span class="hl-7">// Finalize the build</span><br/><span class="hl-1">  .</span><span class="hl-2">build</span><span class="hl-1">()</span><br/><span class="hl-1">  </span><span class="hl-7">// Connect to Looker</span><br/><span class="hl-1">  .</span><span class="hl-2">connect</span><span class="hl-1">()</span><br/><span class="hl-1">  </span><span class="hl-7">// Finish up setup</span><br/><span class="hl-1">  .</span><span class="hl-2">then</span><span class="hl-1">((</span><span class="hl-0">dashboard</span><span class="hl-1">: </span><span class="hl-6">LookerEmbedDashboard</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    ...</span><br/><span class="hl-1">  })</span><br/><span class="hl-1">  .</span><span class="hl-2">catch</span><span class="hl-1">((</span><span class="hl-0">error</span><span class="hl-1">: </span><span class="hl-6">Error</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    ...</span><br/><span class="hl-1">  })</span>
</code></pre>
<p>Note that this functionality is also available to the javascript API. See <a href="demo/message_example.ts">here</a> for how to add this functionality.</p>
</div></div><div class="col-4 col-menu menu-sticky-wrap menu-highlight"><nav class="tsd-navigation primary"><ul><li class="current"><a href="modules.html">Exports</a></li></ul></nav><nav class="tsd-navigation secondary menu-sticky"><ul><li class="tsd-kind-class tsd-has-type-parameter"><a href="classes/EmbedBuilder.html" class="tsd-kind-icon">Embed<wbr/>Builder</a></li><li class="tsd-kind-class tsd-has-type-parameter"><a href="classes/EmbedClient.html" class="tsd-kind-icon">Embed<wbr/>Client</a></li><li class="tsd-kind-class"><a href="classes/LookerEmbedBase.html" class="tsd-kind-icon">Looker<wbr/>Embed<wbr/>Base</a></li><li class="tsd-kind-class"><a href="classes/LookerEmbedDashboard.html" class="tsd-kind-icon">Looker<wbr/>Embed<wbr/>Dashboard</a></li><li class="tsd-kind-class"><a href="classes/LookerEmbedExplore.html" class="tsd-kind-icon">Looker<wbr/>Embed<wbr/>Explore</a></li><li class="tsd-kind-class"><a href="classes/LookerEmbedExtension.html" class="tsd-kind-icon">Looker<wbr/>Embed<wbr/>Extension</a></li><li class="tsd-kind-class"><a href="classes/LookerEmbedLook.html" class="tsd-kind-icon">Looker<wbr/>Embed<wbr/>Look</a></li><li class="tsd-kind-class"><a href="classes/LookerEmbedSDK.html" class="tsd-kind-icon">Looker<wbr/>EmbedSDK</a></li><li class="tsd-kind-interface"><a href="interfaces/AddFilterJson.html" class="tsd-kind-icon">Add<wbr/>Filter<wbr/>Json</a></li><li class="tsd-kind-interface"><a href="interfaces/CancellableEventResponse.html" class="tsd-kind-icon">Cancellable<wbr/>Event<wbr/>Response</a></li><li class="tsd-kind-interface"><a href="interfaces/CookielessRequestInit.html" class="tsd-kind-icon">Cookieless<wbr/>Request<wbr/>Init</a></li><li class="tsd-kind-interface"><a href="interfaces/DashboardEvent.html" class="tsd-kind-icon">Dashboard<wbr/>Event</a></li><li class="tsd-kind-interface"><a href="interfaces/DashboardEventDetail.html" class="tsd-kind-icon">Dashboard<wbr/>Event<wbr/>Detail</a></li><li class="tsd-kind-interface"><a href="interfaces/DashboardLayout.html" class="tsd-kind-icon">Dashboard<wbr/>Layout</a></li><li class="tsd-kind-interface"><a href="interfaces/DashboardLayoutComponent.html" class="tsd-kind-icon">Dashboard<wbr/>Layout<wbr/>Component</a></li><li class="tsd-kind-interface"><a href="interfaces/DashboardTileDownloadEvent.html" class="tsd-kind-icon">Dashboard<wbr/>Tile<wbr/>Download<wbr/>Event</a></li><li class="tsd-kind-interface"><a href="interfaces/DashboardTileEvent.html" class="tsd-kind-icon">Dashboard<wbr/>Tile<wbr/>Event</a></li><li class="tsd-kind-interface"><a href="interfaces/DashboardTileEventDetail.html" class="tsd-kind-icon">Dashboard<wbr/>Tile<wbr/>Event<wbr/>Detail</a></li><li class="tsd-kind-interface"><a href="interfaces/DashboardTileExploreEvent.html" class="tsd-kind-icon">Dashboard<wbr/>Tile<wbr/>Explore<wbr/>Event</a></li><li class="tsd-kind-interface"><a href="interfaces/DashboardTileViewEvent.html" class="tsd-kind-icon">Dashboard<wbr/>Tile<wbr/>View<wbr/>Event</a></li><li class="tsd-kind-interface"><a href="interfaces/DrillMenuEvent.html" class="tsd-kind-icon">Drill<wbr/>Menu<wbr/>Event</a></li><li class="tsd-kind-interface"><a href="interfaces/DrillModalExploreEvent.html" class="tsd-kind-icon">Drill<wbr/>Modal<wbr/>Explore<wbr/>Event</a></li><li class="tsd-kind-interface"><a href="interfaces/ElementOptionItems.html" class="tsd-kind-icon">Element<wbr/>Option<wbr/>Items</a></li><li class="tsd-kind-interface"><a href="interfaces/ElementOptions.html" class="tsd-kind-icon">Element<wbr/>Options</a></li><li class="tsd-kind-interface"><a href="interfaces/EnvClientDialogEvent.html" class="tsd-kind-icon">Env<wbr/>Client<wbr/>Dialog<wbr/>Event</a></li><li class="tsd-kind-interface"><a href="interfaces/EnvHostScrollEvent.html" class="tsd-kind-icon">Env<wbr/>Host<wbr/>Scroll<wbr/>Event</a></li><li class="tsd-kind-interface"><a href="interfaces/EventDetail.html" class="tsd-kind-icon">Event<wbr/>Detail</a></li><li class="tsd-kind-interface"><a href="interfaces/ExploreEvent.html" class="tsd-kind-icon">Explore<wbr/>Event</a></li><li class="tsd-kind-interface"><a href="interfaces/ExploreEventDetail.html" class="tsd-kind-icon">Explore<wbr/>Event<wbr/>Detail</a></li><li class="tsd-kind-interface"><a href="interfaces/LookEvent.html" class="tsd-kind-icon">Look<wbr/>Event</a></li><li class="tsd-kind-interface"><a href="interfaces/LookEventDetail.html" class="tsd-kind-icon">Look<wbr/>Event<wbr/>Detail</a></li><li class="tsd-kind-interface"><a href="interfaces/LookSaveEvent.html" class="tsd-kind-icon">Look<wbr/>Save<wbr/>Event</a></li><li class="tsd-kind-interface"><a href="interfaces/LookSaveEventDetail.html" class="tsd-kind-icon">Look<wbr/>Save<wbr/>Event<wbr/>Detail</a></li><li class="tsd-kind-interface"><a href="interfaces/LookerAuthConfig.html" class="tsd-kind-icon">Looker<wbr/>Auth<wbr/>Config</a></li><li class="tsd-kind-interface"><a href="interfaces/LookerDashboardOptions.html" class="tsd-kind-icon">Looker<wbr/>Dashboard<wbr/>Options</a></li><li class="tsd-kind-interface"><a href="interfaces/LookerEmbedCookielessSessionData.html" class="tsd-kind-icon">Looker<wbr/>Embed<wbr/>Cookieless<wbr/>Session<wbr/>Data</a></li><li class="tsd-kind-interface"><a href="interfaces/LookerEmbedEvent.html" class="tsd-kind-icon">Looker<wbr/>Embed<wbr/>Event</a></li><li class="tsd-kind-interface"><a href="interfaces/LookerEmbedEventMap.html" class="tsd-kind-icon">Looker<wbr/>Embed<wbr/>Event<wbr/>Map</a></li><li class="tsd-kind-interface"><a href="interfaces/LookerEmbedFilterParams.html" class="tsd-kind-icon">Looker<wbr/>Embed<wbr/>Filter<wbr/>Params</a></li><li class="tsd-kind-interface"><a href="interfaces/PageChangedEvent.html" class="tsd-kind-icon">Page<wbr/>Changed<wbr/>Event</a></li><li class="tsd-kind-interface"><a href="interfaces/PageChangedEventDetail.html" class="tsd-kind-icon">Page<wbr/>Changed<wbr/>Event<wbr/>Detail</a></li><li class="tsd-kind-interface"><a href="interfaces/PagePropertiesChangedEvent.html" class="tsd-kind-icon">Page<wbr/>Properties<wbr/>Changed<wbr/>Event</a></li><li class="tsd-kind-interface"><a href="interfaces/QueryError.html" class="tsd-kind-icon">Query<wbr/>Error</a></li><li class="tsd-kind-interface"><a href="interfaces/SessionStatus.html" class="tsd-kind-icon">Session<wbr/>Status</a></li><li class="tsd-kind-interface"><a href="interfaces/TileStatus.html" class="tsd-kind-icon">Tile<wbr/>Status</a></li><li class="tsd-kind-interface"><a href="interfaces/UrlParams.html" class="tsd-kind-icon">Url<wbr/>Params</a></li><li class="tsd-kind-interface"><a href="interfaces/VisConfig.html" class="tsd-kind-icon">Vis<wbr/>Config</a></li><li class="tsd-kind-type-alias"><a href="modules.html#CookielessCallback" class="tsd-kind-icon">Cookieless<wbr/>Callback</a></li><li class="tsd-kind-type-alias"><a href="modules.html#SessionTokenRequest" class="tsd-kind-icon">Session<wbr/>Token<wbr/>Request</a></li></ul></nav></div></div></div><footer class="with-border-bottom"><div class="container"><h2>Legend</h2><div class="tsd-legend-group"><ul class="tsd-legend"><li class="tsd-kind-constructor tsd-parent-kind-class"><span class="tsd-kind-icon">Constructor</span></li><li class="tsd-kind-property tsd-parent-kind-class"><span class="tsd-kind-icon">Property</span></li><li class="tsd-kind-method tsd-parent-kind-class"><span class="tsd-kind-icon">Method</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li><li class="tsd-kind-method tsd-parent-kind-interface"><span class="tsd-kind-icon">Method</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-property tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private property</span></li><li class="tsd-kind-method tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private method</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-method tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited method</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-method tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static method</span></li></ul></div><h2>Settings</h2><p>Theme <select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></p></div></footer><div class="container tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div><script src="assets/main.js"></script></body></html>